<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="hu" lang="hu">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link href="css/scormelte_alap.css" rel="stylesheet" type="text/css" title="" />
<link href="css/style_spec.css" rel="stylesheet" type="text/css" />
<link href="css/scormelte_nagy.css" rel="alternate stylesheet" type="text/css" title="nagy" />
<link href="css/scormelte_inverz.css" rel="alternate stylesheet" type="text/css" title="inverz" />
<!--[if lte IE 6]>
<link href="css/scormelte_ie6.css" rel="stylesheet" type="text/css" title="" />
<![endif]-->
<!-- syntax highlight -->
<link rel="stylesheet" type="text/css" href="css/shCore.css" />
<link rel="stylesheet" type="text/css" href="css/shThemeDefault.css" />
<script type="text/javascript" src="js/shCore.js"></script>
<script type="text/javascript" src="js/shBrushCpp.js"></script>
<script type="text/javascript" src="js/shBrushCSharp.js"></script>
<script type="text/javascript" src="js/shBrushDelphi.js"></script>
<script type="text/javascript" src="js/shBrushXml.js"></script>
<script type="text/javascript" src="js/shBrushCss.js"></script>
<script type="text/javascript" src="js/shBrushJScript.js"></script>
<script type="text/javascript" src="js/shBrushSql.js"></script>
<script type="text/javascript">
SyntaxHighlighter.all()
</script>
<title>
Számítógépes alapismeretek II. / 
A fájlrendszer-kezelés függvényei, alapvető feladatai
/Egyéb alacsony szintű fájlkezelő függvények</title>
<meta name="description" content="A tananyag  fejlesztése a TÁMOP-4.1.2.A/2-10/1 pályázat keretén belül történt." />
<meta name="keywords" content="Hardver alapismeretek, operációs rendszer, számítógépes alapismeretek, operációs rendszer fogalma, operációs rendszerek története, operációs rendszer feladata, operációs rendszer generációk, operációs rendszer típusok, folyamatok, folyamat táblázat, szál &ndash; folyamatok, rendszerhívások, operációs rendszer struktúrák, kernelmód, kernel, felhasználói mód, B/K művelet, folyamatok modellje, szinkron rendszerhívás, asszinkron rendszerhívás, állapotai, megvalósításuk, folyamatok kommunikációja, IPC (Inter Process Communication), megszakítástábla, IDT, megszakításvezérlő, PIC, megszakítás, interrupt, megszakításkérelem, IRQ, megszakításkezelési folyamat, kivétel, hibakeresés (debuggolás), töréspont, fájlrendszer, MBR, partíciós szektor, Ntldr, klaszter (cluster), szektor, FAT, NTFS, ext, TSS, csapda, ütemezés, szál, szemafor, mutex, monitor, POSIX, szignál, osztott memória, csővezeték, kritikus szakasz, Wybe Dijkstra, CPU, erőforrás, holtpont, kiéheztetés, integrált áramkör, multiprogramozás, beágyazott rendszerek, partíció, MMU, lapcsere, FIFO, socket, lapozás, swap, interaktív rendszer, kötegelt rendszer, kliens, job, jogosultság, metaadat, könyvtár, UNIX, GNU/LINUX, erőforrás-foglalási gráf, fizikai memória, virtuális memória, merevlemez, floppy, fregmentáció, defregmentáló program, MFT, API, i-node, cache memory, SSH, HyperThread, párhuzamosság" />
<script type="text/javascript" src="js/jquery-1.3.2.min.js"></script>
<script type="text/javascript" src="js/kep.js"></script>
<script type="text/javascript" src="js/jquery.media.js"></script>
<script type="text/javascript" src="js/jquery.highlight-3.js"></script>
<script type="text/javascript" src="js/kereses.js"></script>
<script type="text/javascript" src="js/stylesheetToggle.js"></script>
<script type="text/javascript" src="js/cookie.js"></script>
<script type="text/javascript" src="js/stilusvalto.js"></script>
<script type="text/javascript" src="js/fogalmak.js"></script>
<script type="text/javascript" src="js/fogalom.js"></script>
<script type="text/javascript" src="js/jwplayer.js"></script>
<script type="text/javascript">
$(document).ready(function() 
{
$("a.hang").media( {width: 250, height: 50,  autoplay: false} );
});
</script>
<script type="text/javascript" src="js/navigacio.js"></script>
</head>
<body>
<div><a name="teteje"  id="teteje"></a></div>
<div class="jawsfmenu">
  <ul>
    <li><a class="tartalom" href="#tartalom" accesskey="t" tabindex="2">Ugrás a <span class="gyorsb">t</span>artalomra</a></li>
    <li><a class="tartalomj" href="#fejezetek" accesskey="j" tabindex="5">Ugrás a tartalom<span class="gyorsb">j</span>egyzékre</a></li>
    <li><a class="tanutm" href="#tanutm" accesskey="u" tabindex="7">Ugrás a tan<span class="gyorsb">u</span>lási útmutatóra</a></li>
  </ul>
</div>
<div class="ki_kereses"></div>
<div class="oldal">
  <div class="utmutato">
    <div class="utm_hivatkozasok"><span class="elozolap"><img src="navi/ikon_vissza_dis.gif" alt="Vissza az előzőleg látogatott oldalra (nem elérhető funkció)" title="Vissza az előzőleg látogatott oldalra (nem elérhető funkció)" /></span><a class="kezdolap" href="index.html" accesskey="p" tabindex="21"><img src="navi/ikon_kezdolap.gif" alt="Vissza a modul kezdőlapjára" title="Vissza a modul kezdőlapjára" width="36" height="36"/></a><a class="elozotanlap" href="lecke3_lap7.html" accesskey="e" tabindex="22"><img src="navi/ikon_elozolap.gif" alt="Ugrás a tananyag előző oldalára" title="Ugrás a tananyag előző oldalára" width="36" height="36" /></a><a class="kovetktanlap" href="lecke3_lap9.html" accesskey="v" tabindex="23"><img src="navi/ikon_kovetklap.gif" alt="Ugrás a tananyag következő oldalára" title="Ugrás a tananyag következő oldalára" width="36" height="36"/></a><span class="ki_fogalomkapcs"><img src="navi/ikon_fogalmakbe_dis.gif" alt="Fogalom megjelenítés (nem elérhető funckió)" title="Fogalom megjelenítés (nem elérhető funckió)" /></span><span class="ki_fogalomlista"><img src="navi/ikon_fogalmaklista_dis.gif" alt="Fogalmak listája (nem elérhető funkció)" title="Fogalmak listája (nem elérhető funkció)" /></span><span class="ki_nyomtatas"><img src="navi/ikon_nyomtatas_dis.gif" alt="Oldal nyomtatása (nem elérhető funkció)" title="Oldal nyomtatása (nem elérhető funkció)" /></span><a class="oldalterkep" href="oldalterkep.html" accesskey="d" tabindex="31"><img src="navi/ikon_oldalterkep.gif" alt="Oldaltérkép megtekintése" title="Oldaltérkép megtekintése"  width="36" height="36" /></a><a class="sugo" href="sugo.html" accesskey="s" tabindex="33"><img src="navi/ikon_sugo.gif" alt="Súgó megtekintése" title="Súgó megtekintése"  width="36" height="36" /></a></div>
  </div>
  <div class="tartalommenu">
    <div class="tartalommenu_fejlec"><span id="lapteteje"><a  href="#teteje"><span class="gyorsb">F</span>el a lap tetejére</a></span><a name="fejezetek"   id="fejezetek">Tartalomjegyzék</a></div>
    <ul><li><a href="#hiv1">A fájlrendszer-kezelés függvényei, alapvető feladatai</a><ul><li><a href="#hiv2">A fájlkezelő függvények leírása (minireferencia)</a><ul><li><a href="#hiv3">Egyéb alacsony szintű fájlkezelő függvények</a></li></ul></li></ul></li></ul> 
  </div>
  <div class="tartalom"> <a name="tartalom"    id="tartalom"></a> 
    <h1><a name="hiv1" id="hiv1"></a>A fájlrendszer-kezelés függvényei, alapvető feladatai</h1><h2><a name="hiv2" id="hiv2"></a>A fájlkezelő függvények leírása (minireferencia)</h2><h3><a name="hiv3" id="hiv3"></a>Egyéb alacsony szintű fájlkezelő függvények</h3><div class="forraskod"><div class="bekezdes1cm">
#include &lt;unistd.h&gt;
int dup(int fajlleiro);  
int dup2(int fajlleiro, int fajlleiro); 
</div>
</div><p>A dup függvény a paraméterben megadott fájlleíró által megadott fájlhoz rendel egy újabb fájlleírót, és ezt adja vissza visszatérési értékként. A dup2 függvénnyel az első paraméterrel megadott fájlleíróhoz rendel egy általunk megadott fájlleírót. A visszatérési érték hiba esetén -1.</p><p>Egy fájl lezárásakor a fájlleíró felszabadul, és a következő fájlleíró kéréséhez ezt adja a rendszer. Ahhoz, hogy ugyanerre a fájlra tudjunk majd a későbbiekben hivatkozni, duplikáljuk a fájlleírót, például a standard kimenetét. Ha lezárjuk a standard kimenetet, nyitunk egy új fájlt, akkor az lesz a standard kimenet. Akkor tudjuk visszakapni a normál kimenetet, ha lezárás előtt duplikáltuk azt.</p><div class="forraskod"><div class="bekezdes1cm">
 #include &lt;stdio.h&gt;
int rename(const char * reginev, const char * ujnev);
</div>
</div><p>A rename függvény egy fájl átnevezését végzi el. A függvény első paramétere az átnevezendő fájl régi neve, a második paraméter a fájl új neve. A visszatérési érték -1, ha hibás a művelet.</p><div class="forraskod"><div class="bekezdes1cm">
#include &lt;unistd.h&gt;
int close( int fajlleiro );
</div>
</div><p>A close függvény bezárja a paraméterében megadott fájlt. A fájlt a fájlleírója alapján azonosítja, ezért a fájlleírót kell konkrétan megadni a paramétereként. A visszatérési érték 0 lesz, ha sikeres volt a fájl bezárása, különben -1, ha a fájl bezárása közben valamilyen hiba történt, és emiatt hibás a végrehajtás. A close függvény az errno hibaértéket is állítja.</p><div class="forraskod"><div class="bekezdes1cm">
#include &lt;sys/types.h&gt;
#include &lt;unistd.h&gt;
#include &lt;fcntl.h&gt;
int fcntl( int fajlleiro, int mod, struct flock * lefoglalando_resz );
</div>
</div><p>A <span class="fogalom" title="UNIX">UNIX</span> és a <span class="fogalom" title="UNIX">UNIX</span> -szerű (pl. a <span class="fogalom" title="GNU/LINUX">GNU/LINUX</span>) <span class="fogalom" title="operációs rendszer">operációs rendszerekben</span> a fájlok konkurens kezelésekor kialakult problémás helyzeteket esetén a rekordlefoglalás (locking) lehetőségét biztosítja. A rekordlefoglalás az fcntl függvény segítségével valósítható meg. A függvény használatához szükségünk van az fcntl.h header fájl használatbavételére.</p><p>Az fcntl függvény az első paraméterében megadott fájlleíróval azonosított fájlnak a harmadik paraméterben megadott részét a második paraméterben megadott módon lefoglalja. Az fcntl függvény sikertelen lesz például egy írási célú rekordlefoglalás esetén, ha a fájlra nincs írási engedélye a futtató felhasználónak. </p><p><em>Az fcntl függvény második paramétere a rekordlefoglalás módja, amely meghatározza, hogy az fnctl függvény milyen módon foglalja le a fájl meghatározott részét. A lefoglalási módokra a következő értékekkel hivatkozhatunk:</em></p><table class="lecke">
<tr><th><p><strong>Érték</strong></p></th><th><p>Leírás</p></th></tr><tr><td><p><strong>F_GETLK</strong></p></td><td><p>A lefoglalandó részre vonatkozó rekordlefoglalási információkat kapjuk vissza.</p></td></tr><tr><td><p><strong>F_SETLK</strong></p></td><td><p>A lefoglalandó részre vonatkozó rekordterületet ezzel lehet lefoglalni, vagy egy korábban kért lefoglalási kérelmet hatástalanítani. A flock típusú változó ltype komponensének értéke alapján dönti el a lefoglalás célját. Ha a rekordlefoglalási igény az fcntl függvény végrehajtásának pillanatában nem kielégíthető, akkor az fcntl függvény sikertelen visszatérési értékkel tér vissza, és nem fogja a rekord-lefoglalási igényt teljesíteni.</p></td></tr><tr><td><p><strong>F_SETLKW</strong></p></td><td><p>Ugyanazt teszi, mint az F_SETLK, de ez a folyamatot megvárakoztatja olyan esetben, ha a rekordlefoglalási igény nem kielégíthető. A folyamat egészen addig várakozik.</p></td></tr></table><p><em>A flock típus az fcntl.h header fájlban van meghatározva. A flock típus a következőképpen épül fel:</em></p><div class="forraskod"><div class="bekezdes1cm">
struct flock {
         short l_type;        // Az l_type értéke F_RDLCK, vagy F_WRLCK, vagy 
                                // pedig F_UNLCK lehet. 
         short l_whence;     // Az l_whence értéke SEEK_SET, vagy SEEK_CUR, 
                                // vagy SEEK_END lehet az l_start szerint. 
         off_t l_start;      // Az l_start értéke a lefoglalandó rekordterület 
                                // kezdőpozícióját adja meg az l_whence-hez képest. 
         off_t l_len;        // Az l_len komponensben kell megadni a lefoglalandó 
                                // rekordterület hosszát bájtokban mérve. 
         pid_t l_pid;        // Az F_GETLK az l_pid komponensben adja vissza 
                                // a többi komponensben megadott rekordterületet 
                                // lefoglaltan tartó folyamat azonosítóját. 
};
</div>
</div><p>Ha az l_len értékeként a nulla értéket adjuk meg, akkor a fájl végéig az egész fájl tartalmát foglaljuk le úgy, hogy akár ebbe beleérthetők a később hozzáfűzött adatok is.</p><p><em>A flock típusú változóstruktúra ltype komponensének értéke alapján a rekordlefoglalást végezhetjük el. A lefoglalási módokra a következő értékekkel hivatkozhatunk::</em></p><table class="lecke">
<tr><th><p><strong>Érték</strong></p></th><th><p>Leírás</p></th></tr><tr><td><p><strong>F_RDLCK</strong></p></td><td><p>Olvasási céllal való lefoglalás.</p></td></tr><tr><td><p><strong>F_WRLCK</strong></p></td><td><p>Írási céllal való lefoglalás.</p></td></tr><tr><td><p><strong>F_UNLCK</strong></p></td><td><p>A rekordlefoglalási kérelem visszavonása, érvénytelenítése.</p></td></tr></table><div class="forraskod"><div class="bekezdes1cm">
#include &lt;unistd.h&gt;
int access(const char fajlnev, int mod);
</div>
</div><p>Az access függvény ellenőrzi, hogy az első paramétereként megadott fájl rendelkezik-e a második paraméterében megadott <span class="fogalom" title="jogosultság">jogosultságokkal</span>. Az első paraméterben nem fájlleírót vár az access függvény, hanem a fájlnak a <span class="fogalom" title="Fájlrendszer">fájlrendszerben</span> levő abszolút elérési útvonalát. A megadott <span class="fogalom" title="jogosultság">jogosultságokkal</span> való rendelkezést az alapján határozza meg az access függvény, hogy magának a programot (és azon belül is ezt az access függvényt) futtató személynek megvannak-e ezek a <span class="fogalom" title="jogosultság">jogosultságai</span> az adott fájlra nézve. Ha az access függvény a 0 értékkel tér vissza, akkor a kért jogosítvánnyal (<span class="fogalom" title="jogosultság">jogosultsági</span> jogkörrel) rendelkezik a futtató felhasználó, ha a visszatérési érték -1, akkor a futtató felhasználó nem rendelkezik a kért jogosítvánnyal (vagy nem létezik). Az access függvény az errno hibaértéket állítja. </p><p><em>Az access függvény harmadik paramétere egy jogosultságérték, amely meghatározza, hogy az access függvény, milyen <span class="fogalom" title="jogosultság">jogosultság</span> meglétét vizsgálja. A <span class="fogalom" title="jogosultság">jogosultságokra</span> a következő értékekkel hivatkozhatunk:</em></p><table class="lecke">
<tr><th><p><strong>Érték</strong></p></th><th><p>Leírás</p></th></tr><tr><td><p><strong>R_OK</strong></p></td><td><p>Olvasási joga van-e.</p></td></tr><tr><td><p><strong>W_OK</strong></p></td><td><p>Írási joga van-e.</p></td></tr><tr><td><p><strong>X_OK</strong></p></td><td><p>Futtatási joga van-e.</p></td></tr><tr><td><p><strong>F_OK</strong></p></td><td><p>Létezik-e az állomány</p></td></tr></table><p>A soron következő függvények használatához ne felejtsük el használatba venni minden esetben az <em>unistd.h</em>, a <em>sys/types.h</em> és a <em>sys/stat.h</em> header fájlokat! </p><div class="forraskod"><div class="bekezdes1cm">
#include &lt;unistd.h&gt;
#include &lt;sys/types.h&gt;
#include &lt;sys/stat.h&gt;
int stat(const char* fnev, struct stat* statusz);
int fstat(int fajlleiro, struct stat* statusz);
</div>
</div><p>A stat és az fstat függvényekkel egy megadott fájl státuszát kérdezhetjük le. A &#132;státusz&#148; értéke a második paraméterben stat típusú paraméterbe kerül. A stat függvény a fájlnév alapján, az fstat pedig fájlleíró alapján dolgozik. A két függvény között ez a lényegi különbség! A stat és az fstat függvények visszatérési értéke -1 hiba esetén. </p><p><em>A stat típusú struktúra a sys/stat.h header fájlban van meghatározva. A stat típusú struktúra a következőképpen épül fel:</em></p><div class="forraskod"><div class="bekezdes1cm">
struct stat {
      dev_t     st_dev     // Az i-csomóponthoz tartozó eszköz. 
      ino_t     st_ino     // Az i-csomópont. 
      mode_t    st_mode    // A mód. 
      nlink_t   st_nlink   // A linkek száma. 
      uid_t     st_uid     // A felhasználói uid azonosító. 
      gid_t     st_gid     // A csoportazonosító.
      dev_t     st_rdev    // A fő- vagy mellékeszköz. 
      off_t     st_size    // A fájlméret. 
      time_t    st_atime   // Az utolsó hozzáfordulás időpontja. 
      time_t    st_mtime   // Az utolsó módosítás ideje. 
      time_t    st_ctime   // Az utolsó i-csomópont módosítási ideje. 
      blksize_t st_blksize // A fájlrendszerben az adott fájlra vonatkozó 
                           // I/O blokkméret. 
      blkcnt_t  st_blocks  // A lefoglalt blokkok száma. 
}
</div>
</div><p>A stat típusú struktúrákról a következő fejezetben lesz bővebben szó. </p><p><em>Példa az access függvény használatára:</em></p><div class="forraskod"><div class="bekezdes1cm">
if (access(&#148;fajlnev_eleresi_utvonala&#148;,F_OK) == 0){ printf("Letezik a fajl"); }
// Az elágazás logikai feltétele az access függvény, amivel
// megvizsgáljuk, hogy az első paramétereként átadott fájlunk
// létezik-e. 
// Ha az access függvényünk -1 értékkel tér vissza, akkor nem
// létezik az első paraméterben megadott fájl, ám ha az access
// függvény 0 értékkel tér vissza, akkor létezik a fájl a
// megadott elérési útvonalon. Erre szolgál ez az elágazás.
// A printf függvénnyel tudjuk a &#132;Letezik a fajl&#148; üzenetet 
// kiírni a standard kimenetre (stdout), természetesen ezt 
// az elágazás miatt csak akkor, ha a visszatérési értéke az
// access függvénynek nulla érték volt.
</div>
</div><p><em>Példa a stat függvény használatára:</em></p><div class="forraskod"><div class="bekezdes1cm">
struct stat * statusz; 
// Először deklarálnunk kell egy stat típusú változót.
if(stat("fajlnev_eleresi_utvonala",&#38;statusz) == -1) { 
   perror("Hiba tortent a statuszinformaciok lekerdezesenel"); 
}
// Az elágazás logikai feltétele a stat függvény, amivel
// megvizsgáljuk, hogy az első paramétereként átadott fájlunk
// státuszinformációit kérdezhetjük le. 
// Ha a stat függvényünk -1 értékkel tér vissza, akkor hiba
// történt az első paraméterben megadott fájl státuszának 
// lekérdezése közben, ám ha a stat függvény 0 értékkel tér 
// vissza, akkor sikeres volt a fájl státuszát lekérdezni a
// megadott elérési útvonalon. Erre szolgál ez az elágazás.
// A perror függvénnyel tudjuk a &#132;Hiba tortent a 
// statuszinformaciok lekerdezesenel&#148; üzenetet kiírni a 
// standard hibakimenetre (stderr), természetesen ezt 
// az elágazás miatt csak akkor, ha a visszatérési értéke a
// stat függvénynek -1 érték volt.
</div>
</div><p class="vissza"><a href="#fejezetek">Vissza a tartalom<span class="gyorsb">j</span>egyzékhez</a></p> 
  </div>
</div>
<div class="utmutato_also">
  <div class="utm_hivatkozasok_also"><a class="oldalteteje" accesskey="f" href="#teteje"><span class="gyorsb">F</span>el a lap tetejére</a>
  <a class="elozotanlap" id="navialsoelozo" href="lecke3_lap7.html"><img src="navi/ikon_elozolap.gif" alt="Ugrás a tananyag előző oldalára" title="Ugrás a tananyag előző oldalára" width="36" height="36" /></a>
  <a id='navialsokov' class="kovetktanlap" href="lecke3_lap9.html" ><img src="navi/ikon_kovetklap.gif" alt="Ugrás a tananyag következő oldalára" title="Ugrás a tananyag következő oldalára" width="36" height="36"/></a>
  </div>
</div>
<div class="ki_stilus"></div>
<div class="impresszum">
  <table class="uszt">
    <tr>
      <td><div class="imp_eltetatklogo"><img alt="ELTE és ELTE TáTK logó" src="css/arculat/elte_plus_tatk.png" style="width:100%;height:auto;" /></div>
        <div class="imp_elteiklogo"><img alt="ELTE és ELTE IK logó" src="css/arculat/elte_plus_ik.png" style="width:100%;height:auto;" /></div></td>
      <td><div class="imp_uszt"><img alt="Új Széchenyi terv" src="css/arculat/USZT_logo_cmyk.jpg" style="width:100%;height:auto;" /></div></td>
      <td><div class="imp_eu"><img alt="A projekt az Európai Unió támogatásával, az Európai Szociális Alap társfinanszirozásával valósul meg." title="A projekt az Európai Unió támogatásával, az Európai Szociális Alap társfinanszirozásával valósul meg." src="css/arculat/ESZA.png" style="width:100%;height:auto;"/></div></td>
    </tr>
  </table>
</div>
</body>
</html>