<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="hu" lang="hu">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link href="css/scormelte_alap.css" rel="stylesheet" type="text/css" title="" />
<link href="css/style_spec.css" rel="stylesheet" type="text/css" />
<link href="css/scormelte_nagy.css" rel="alternate stylesheet" type="text/css" title="nagy" />
<link href="css/scormelte_inverz.css" rel="alternate stylesheet" type="text/css" title="inverz" />
<!--[if lte IE 6]>
<link href="css/scormelte_ie6.css" rel="stylesheet" type="text/css" title="" />
<![endif]-->
<!-- syntax highlight -->
<link rel="stylesheet" type="text/css" href="css/shCore.css" />
<link rel="stylesheet" type="text/css" href="css/shThemeDefault.css" />
<script type="text/javascript" src="js/shCore.js"></script>
<script type="text/javascript" src="js/shBrushCpp.js"></script>
<script type="text/javascript" src="js/shBrushCSharp.js"></script>
<script type="text/javascript" src="js/shBrushDelphi.js"></script>
<script type="text/javascript" src="js/shBrushXml.js"></script>
<script type="text/javascript" src="js/shBrushCss.js"></script>
<script type="text/javascript" src="js/shBrushJScript.js"></script>
<script type="text/javascript" src="js/shBrushSql.js"></script>
<script type="text/javascript">
SyntaxHighlighter.all()
</script>
<title>
Számítógépes alapismeretek II.</title>
<meta name="description" content="A tananyag  fejlesztése a TÁMOP-4.1.2.A/2-10/1 pályázat keretén belül történt." />
<meta name="keywords" content="Hardver alapismeretek, operációs rendszer, számítógépes alapismeretek, operációs rendszer fogalma, operációs rendszerek története, operációs rendszer feladata, operációs rendszer generációk, operációs rendszer típusok, folyamatok, folyamat táblázat, szál &ndash; folyamatok, rendszerhívások, operációs rendszer struktúrák, kernelmód, kernel, felhasználói mód, B/K művelet, folyamatok modellje, szinkron rendszerhívás, asszinkron rendszerhívás, állapotai, megvalósításuk, folyamatok kommunikációja, IPC (Inter Process Communication), megszakítástábla, IDT, megszakításvezérlő, PIC, megszakítás, interrupt, megszakításkérelem, IRQ, megszakításkezelési folyamat, kivétel, hibakeresés (debuggolás), töréspont, fájlrendszer, MBR, partíciós szektor, Ntldr, klaszter (cluster), szektor, FAT, NTFS, ext, TSS, csapda, ütemezés, szál, szemafor, mutex, monitor, POSIX, szignál, osztott memória, csővezeték, kritikus szakasz, Wybe Dijkstra, CPU, erőforrás, holtpont, kiéheztetés, integrált áramkör, multiprogramozás, beágyazott rendszerek, partíció, MMU, lapcsere, FIFO, socket, lapozás, swap, interaktív rendszer, kötegelt rendszer, kliens, job, jogosultság, metaadat, könyvtár, UNIX, GNU/LINUX, erőforrás-foglalási gráf, fizikai memória, virtuális memória, merevlemez, floppy, fregmentáció, defregmentáló program, MFT, API, i-node, cache memory, SSH, HyperThread, párhuzamosság" />
<script type="text/javascript" src="js/jquery-1.3.2.min.js"></script>
<script type="text/javascript" src="js/kep.js"></script>
<script type="text/javascript" src="js/jquery.media.js"></script>
<script type="text/javascript" src="js/jquery.highlight-3.js"></script>
<script type="text/javascript" src="js/kereses.js"></script>
<script type="text/javascript" src="js/stylesheetToggle.js"></script>
<script type="text/javascript" src="js/cookie.js"></script>
<script type="text/javascript" src="js/stilusvalto.js"></script>
<script type="text/javascript" src="js/fogalmak.js"></script>
<script type="text/javascript" src="js/fogalom.js"></script>
<script type="text/javascript" src="js/jwplayer.js"></script>
<script type="text/javascript">
$(document).ready(function() 
{
$("a.hang").media( {width: 250, height: 50,  autoplay: false} );
});
</script>
<script type="text/javascript" src="js/navigacio.js"></script>
</head>
<body>
<div><a name="teteje"  id="teteje"></a></div>
<div class="jawsfmenu">
  <ul>
    <li><a class="tartalom" href="#tartalom" accesskey="t" tabindex="2">Ugrás a <span class="gyorsb">t</span>artalomra</a></li>
    <li><a class="tartalomj" href="#fejezetek" accesskey="j" tabindex="5">Ugrás a tartalom<span class="gyorsb">j</span>egyzékre</a></li>
    <li><a class="tanutm" href="#tanutm" accesskey="u" tabindex="7">Ugrás a tan<span class="gyorsb">u</span>lási útmutatóra</a></li>
  </ul>
</div>
<div class="ki_kereses"></div>
<div class="oldal">
  <div class="utmutato">
    <div class="utm_hivatkozasok"><span class="elozolap"><img src="navi/ikon_vissza_dis.gif" alt="Vissza az előzőleg látogatott oldalra (nem elérhető funkció)" title="Vissza az előzőleg látogatott oldalra (nem elérhető funkció)" /></span><a class="kezdolap" href="index.html" accesskey="p" tabindex="21"><img src="navi/ikon_kezdolap.gif" alt="Vissza a modul kezdőlapjára" title="Vissza a modul kezdőlapjára" width="36" height="36"/></a><a class="elozotanlap" href="teszt/lecke10/teszt.html" accesskey="e" tabindex="22"><img src="navi/ikon_elozolap.gif" alt="Ugrás a tananyag előző oldalára" title="Ugrás a tananyag előző oldalára" width="36" height="36" /></a><a class="kovetktanlap" href="lecke11_lap2.html" accesskey="v" tabindex="23"><img src="navi/ikon_kovetklap.gif" alt="Ugrás a tananyag következő oldalára" title="Ugrás a tananyag következő oldalára" width="36" height="36"/></a><span class="ki_fogalomkapcs"><img src="navi/ikon_fogalmakbe_dis.gif" alt="Fogalom megjelenítés (nem elérhető funckió)" title="Fogalom megjelenítés (nem elérhető funckió)" /></span><span class="ki_fogalomlista"><img src="navi/ikon_fogalmaklista_dis.gif" alt="Fogalmak listája (nem elérhető funkció)" title="Fogalmak listája (nem elérhető funkció)" /></span><span class="ki_nyomtatas"><img src="navi/ikon_nyomtatas_dis.gif" alt="Oldal nyomtatása (nem elérhető funkció)" title="Oldal nyomtatása (nem elérhető funkció)" /></span><a class="oldalterkep" href="oldalterkep.html" accesskey="d" tabindex="31"><img src="navi/ikon_oldalterkep.gif" alt="Oldaltérkép megtekintése" title="Oldaltérkép megtekintése"  width="36" height="36" /></a><a class="sugo" href="sugo.html" accesskey="s" tabindex="33"><img src="navi/ikon_sugo.gif" alt="Súgó megtekintése" title="Súgó megtekintése"  width="36" height="36" /></a></div>
    <h1 class="utmutato"><a name="tanutm"  id="tanutm"></a>Tanulási útmutató</h1>
    <div class="osszefoglalas">
      <h2>Összefoglalás </h2>
      <!--{fej11_video_1}--><div class="video"> <div class="felirat">Összefoglaló (11. fejezet) című videó megtekintése,letöltése</div><div class="jaws"><ul><li><a href="#tartalmi_1"> Ugrás a videó tartalmi összefoglalójára. A videó címe: Összefoglaló (11. fejezet).</a></li><li><a href="#teljesszov_1">Ugrás a videó teljes szövegű leírására. A videó címe: Összefoglaló (11. fejezet).</a></li><li><a href="#video_1">Ugrás a videó kisebb felbontású változatának letöltéséhez. A videó címe: Összefoglaló (11. fejezet).</a></li><li><a href="#video_2">Ugrás a videó nagy felbontású változatának letöltéséhez. A videó címe: Összefoglaló (11. fejezet).</a></li></ul></div><div class="kepkockak"><span>A film néhány jellemző képkockája: </span><div class="kep kozep sz550"> <img src="videok/film_video.jpg" alt="Néhány képkocka a filmből." style="width:100%; height:auto;" title="Néhány képkocka a filmből." /> </div></div><div class="filmtartalom"><p><span class="filmtartalom"><a name="tartalmi_1"  id="tartalmi_1">Tartalom:</a></span>A videón az összefoglaló hallgatható meg.</p><p class="videohtml"><a href="videok/osszefoglalo_11.html" name="teljesszov_1"  id="teljesszov_1"><span class="jaws">Összefoglaló (11. fejezet) című </span> Videó szöveges leírásának megtekintése HTML formátumban.</a> </p></div><div class="letoltes_doboz"><div id="player1"><p class="vid_flv"><a title="" href="videok/11_agk.flv"><span class="jaws">Összefoglaló (11. fejezet) című  </span>Videó letöltése Flash videó formátumban. <span class="filemeret"><span class="filemeret_cimke">A fájl mérete:</span>1.62<abbr title="megabájt">MB</abbr></span></a></p></div><script type="text/javascript">jwplayer("player1").setup({flashplayer: "player.swf",file:"videok/11_agk.flv",wmode: "opaque",width: "100%",skin: "css/skins/darkrv5.zip",controlbar: "over"});</script></div><div class="ido">A videó hossza: 0000 perc 22 másodperc.</div><div class="letoltes"><div class="letoltes_felirat"><span class="jaws">Összefoglaló (11. fejezet) című </span>Videó kisebb és nagyobb felbontású változatainak letöltése különböző formátumokban</div><a name="video_1"  id="video_1"></a><ul><li><a title="Összefoglaló (11. fejezet) című videó letöltése 3GP formátumban (kis változat)" href="videok/11_agk_kismeret.3gp"><span class="jaws">Összefoglaló (11. fejezet) című  videó kis felbontású változatának letöltése <span class="formatum">3GP</span> formátumban. </span><span class="meret_3gp_kis"><img src="css/3gp_kis.gif"  alt="Kis felbontású, 3GP változat letöltése" /><span class="jaws">Fájlméret:</span><span class="videomeret"><span class="meret_megabajt">0.28</span><span class="megabajt"><abbr title="megabájt">MB</abbr></span></span></span></a></li><li><a title="Összefoglaló (11. fejezet) című videó letöltése AVI (DivX) formátumban (kis változat)" href="videok/11_agk_kismeret.avi"><span class="jaws">Összefoglaló (11. fejezet) című videó kis felbontású változatának letöltése <span class="formatum">AVI (DivX)</span> formátumban.</span><span class="meret_avi_kis"><img src="css/avi_kis.gif"  alt="Kis felbontású, AVI változat letöltése" /><span class="jaws">Fájlméret:</span><span class="videomeret"><span class="meret_megabajt">1.29</span><span class="megabajt"><abbr title="megabájt">MB</abbr></span></span></span></a></li><li><a title="Összefoglaló (11. fejezet) című videó letöltése MP4 formátumban (kis változat)" href="videok/11_agk_kismeret.mp4"><span class="jaws">Összefoglaló (11. fejezet) című  videó kis felbontású változatának letöltése <span class="formatum">MP4</span> formátumban. </span><span class="meret_mp4_kis"><img src="css/mp4_kis.gif"  alt="Kis felbontású, MP4 változat letöltése" /><span class="jaws">Fájlméret:</span><span class="videomeret"><span class="meret_megabajt">1.29</span><span class="megabajt"><abbr title="megabájt">MB</abbr></span></span></span></a></li><li><a title="Összefoglaló (11. fejezet) című videó letöltése WMV formátumban (kis változat)" href="videok/11_agk_kismeret.wmv"><span class="jaws">Összefoglaló (11. fejezet) című videó kis felbontású változatának letöltése <span class="formatum">WMV</span> formátumban.</span><span class="meret_wmv_kis"><img src="css/wmv_kis.gif"  alt="Kis felbontású, WMV változat letöltése" /><span class="jaws">Fájlméret:</span><span class="videomeret"><span class="meret_megabajt">1.21</span><span class="megabajt"><abbr title="megabájt">MB</abbr></span></span></span></a></li></ul><a name="video_2"  id="video_2"></a><ul><li><a title="Összefoglaló (11. fejezet) című videó letöltése 3GP formátumban (nagy változat)" href="videok/11_agk.3gp"><span class="jaws">Összefoglaló (11. fejezet) című  videó nagy felbontású változatának letöltése <span class="formatum">3GP</span> formátumban. </span><span class="meret_3gp_nagy"><img src="css/3gp_nagy.gif"  alt="Nagyobb felbontású, 3GP változat letöltése" /><span class="jaws">Fájlméret:</span><span class="videomeret"><span class="meret_megabajt">0.93</span><span class="megabajt"><abbr title="megabájt">MB</abbr></span></span></span></a></li><li><a title="Összefoglaló (11. fejezet) című videó letöltése AVI (DivX) formátumban (nagy változat)" href="videok/11_agk.avi"><span class="jaws">Összefoglaló (11. fejezet) című videó nagy felbontású változatának letöltése <span class="formatum">AVI (DivX)</span> formátumban.</span><span class="meret_avi_nagy"><img src="css/avi_nagy.gif"  alt="Nagyobb felbontású, AVI változat letöltése" /><span class="jaws">Fájlméret:</span><span class="videomeret"><span class="meret_megabajt">3.13</span><span class="megabajt"><abbr title="megabájt">MB</abbr></span></span></span></a></li><li><a title="Összefoglaló (11. fejezet) című videó letöltése MP4 formátumban (nagy változat)" href="videok/11_agk.mp4"><span class="jaws">Összefoglaló (11. fejezet) című  videó nagy felbontású változatának letöltése <span class="formatum">MP4</span> formátumban. </span><span class="meret_mp4_nagy"><img src="css/mp4_nagy.gif"  alt="Nagyobb felbontású, MP4 változat letöltése" /><span class="jaws">Fájlméret:</span><span class="videomeret"><span class="meret_megabajt">3.21</span><span class="megabajt"><abbr title="megabájt">MB</abbr></span></span></span></a></li><li><a title="Összefoglaló (11. fejezet) című videó letöltése WMV formátumban (nagy változat)" href="videok/11_agk.wmv"><span class="jaws">Összefoglaló (11. fejezet) című videó nagy felbontású változatának letöltése <span class="formatum">WMV</span> formátumban.</span><span class="meret_wmv_nagy"><img src="css/wmv_nagy.gif"  alt="Nagyobb felbontású, WMV változat letöltése" /><span class="jaws">Fájlméret:</span><span class="videomeret"><span class="meret_megabajt">3.1</span><span class="megabajt"><abbr title="megabájt">MB</abbr></span></span></span></a></li></ul><div class="nemlebeg"></div></div><div class="nemlebeg"></div></div><!--END{fej11_video_1}--><p>A leckében bemutatjuk a leggyakrabban használt folyamatok közötti kommunikációs eszközöket, példák segítségével megismertetjük azok használatát.</p> 
    </div>
    <div class="kovetelmeny">
      <h2>Követelmény </h2>
      <p>A tanuló ismerje az alapvető folyamatok közötti kommunikációs eszközöket, képes legyen azok felhasználásával folyamatok közötti kommunikációs feladatok megoldására.</p> 
    </div>
    <div class="feladatok">
      <h2>Önállóan megoldható feladatok</h2>
      <ul><li>Egy &#132;termelő&#148;-folyamat állítson elő egyszámjegyű véletlen számokat &ndash; a <em>rand()</em> függvénnyel &ndash; az első nulla számjegyig! Minden szám előállítása után küldje el a &#132;fogyasztó&#148;-folyamatnak csővezetéken! A fogyasztó a csővezetékből kiolvassa a kapott számokat, és online összegzi (azaz menet közben összegzi, és nem egy tömbbe rakosgatja). Miután nem kap már több számot, az összeget kiírja. A termelőfolyamat megvárja, míg véget ér a fogyasztófolyamat.</li><li>Írjon egy egyszerű kétszemélyes csevegő (chat) programot! A program parancssori argumentuma egy állomány elérési útvonala legyen! Ha létezik az állomány, akkor nyissuk meg! Ha nem, akkor hozzuk létre FIFO-ként, és szintén nyissuk meg! A program egy példánya kérjen be egy sort a felhasználótól, írja a FIFO-ba, majd olvassa ki onnan a választ, és írja ki a felhasználó képernyőjére! Ezt felváltva tegye a két folyamat, az egyik írással kezdje, a másik olvasással, attól függően, hogy melyik hozta létre a FIFO-t!</li><li>Egy megosztott memóriaterületen tároljunk egy szöveget! Az egyik folyamat három másodpercenként olvassa ki a tartalmát, és írja ki a standard kimenetre (az stdout-ra), a másik folyamat olvasson be egy szöveget a standard bemenetről (az stdin-ről), és rakja a megosztott területre, amíg az &#132;exit&#148; szöveget nem kapja! A folyamatok <span class="fogalom" title="kritikus szakasz">kritikus szakasza</span> a megosztott memória olvasása, illetve a megosztott memória írása, ezt szemaforral védjük. </li><li>Írjon egy igen egyszerű webszervert! A program képes legyen párhuzamosan több böngésző kiszolgálására több párhuzamos folyamat segítségével. A szülőfolyamat a socket szerverként várakozzon a böngésző kliensre, majd egy böngésző kapcsolatfelvétele esetén hozzon létre egy gyerekfolyamatot, amely kiszolgálja a kérést. A böngésző egy állománynevet küld el (&#132;GET proba.html&#148;), a webszerver a saját maga által definiált gyökérkönyvtárra vonatkozóan megkeresi ezt az állományt, és visszaküldi a böngészőnek (head + file). A webszerver démonként fusson, kezelje a SIGCHLD, SIGTERM <span class="fogalom" title="szignál">szignálokat</span>, és ne &#132;termeljen&#148; zombi folyamatokat! A böngésző által kért fájlt a fájl méretével azonos, dinamikusan lefoglalt memóriaterületre olvassa be (ha tudja), majd küldje el!</li></ul> 
    </div>
  </div>
  <div class="tartalommenu">
    <div class="tartalommenu_fejlec"><span id="lapteteje"><a  href="#teteje"><span class="gyorsb">F</span>el a lap tetejére</a></span><a name="fejezetek"   id="fejezetek">Tartalomjegyzék</a></div>
    <ul><li><a href="#hiv1">Osztott memória, üzenetküldés, rendszerhívások és alkalmazásaik. A folyamatok közötti kommunikáció</a><ul><li><a href="#hiv2">Az osztott memória</a><ul><li><a href="#hiv3">A megosztott memória használata</a></li><li><a href="#hiv4">A kulcsgenerálás, az ftok függvény</a></li><li><a href="#hiv5">A megosztott memória létrehozása, az shmget függvény:</a></li><li><a href="#hiv6">A megosztott memóriaterület elérése, az shmat függvény</a></li><li><a href="#hiv7">A megosztott memóriaterület leválasztása, az shmdt függvény</a></li><li><a href="#hiv8">A megosztott memóriaterület kezelése, az shctl függvény</a></li></ul></li></ul></li></ul> 
  </div>
  <div class="tartalom"> <a name="tartalom" id="tartalom"></a> 
    <h1><a name="hiv1" id="hiv1" ></a>Osztott memória, üzenetküldés, rendszerhívások és alkalmazásaik. A folyamatok közötti kommunikáció</h1><h2><a name="hiv2" id="hiv2" ></a>Az osztott memória</h2><p>A megosztott memória segítségével megoldható, hogy különböző folyamatok ugyanazt a memóriaterületet közösen használják. A közösen használt memóriaterület lehetőséget ad az adatok megosztására és a gyors kommunikációra. A rendszer csak a hozzáférési jogosultságokat kezeli, tehát az egyidejű közös erőforrás-használat következményeként versenyhelyzet alakulhat ki. A versenyhelyzetek kezelése a felhasználói folyamatok feladata.</p><h3><a name="hiv3" id="hiv3" ></a>A megosztott memória használata</h3><p>A megosztott memóriahasználat első lépéseként létre kell hozni a megosztott memóriaterületet. Ezt az <strong>shmget</strong> függvénnyel tudjuk megtenni. Az shmget függvény által visszaadott azonosító segítségével lehet csatlakozni a megosztott memóriához, leválni a megosztott memóriáról, illetve adminisztrálni és törölni a megosztott memóriát. </p><p>Mielőtt használni szeretnénk a megosztott memóriát, csatlakozni kell az <strong>shmat</strong> függvény segítségével. Az shmat függvény adja meg a címet, amelyen keresztül elérhetjük a megosztott memóriát. Használat után célszerű leválni a megosztott memóriáról, amit az <strong>shmdt</strong> függvény segítségével tudunk megtenni. Ennek elmulasztása esetén a folyamat kilépésekor a rendszer automatikusan leválasztja a folyamatot. Miután már egyik folyamat sem szeretné használni a megosztott memóriát, az <strong>shmctl</strong> függvénnyel tudjuk kitörölni. A kitörlés csak akkor történik meg, ha minden folyamat levált már a megosztott memóriáról. A rendszerben lévő IPC-eszközök (megosztott memória, <span class="fogalom" title="szemafor">szemafor</span>, üzenetsor) elérhetők az <strong>ipcs</strong> shell parancs segítségével.</p><h3><a name="hiv4" id="hiv4" ></a>A kulcsgenerálás, az ftok függvény</h3><p>Egy System V IPC kulcsot generálni az <strong>ftok</strong> függvénnyel tudunk. Az ftok függvény első paraméterének adjunk egy létező állománynevet, a második paraméternek pedig egy változatszámot. Az ftok<em> </em>függvény megnyitja az állományt, és a tartalmából a változatszám felhasználásával hasít egy kulcsot. Ugyanazzal az állománnyal és változatszámmal meghívva ugyanazt a kulcsot generálja. Bármelyik paraméter megváltoztatására más kulcsot generál.</p><div class="forraskod"><div class="bekezdes1cm">

#include &lt;sys/types.h&gt; 
#include &lt;sys/ipc.h&gt; 

key_t ftok(const char * pathname, int proj_id);
</div>
</div><p>Az ftok függvény paraméterei:</p><ul><li><strong>pathname</strong>: egy létező állomány neve, amelyet megnyit, és segítségével hozza létre a kulcsot.</li><li><strong>proj_id</strong>: a változat száma, ugyanazon pathname esetén ennek függvényében generál különböző kulcsot. Csak az alsó 1 bájtot használja, amelynek értéke nem lehet nulla.</li></ul><p>Az ftok függvény visszatérési értéke: </p><ul><li>Sikeres végrehajtás esetén a létrehozott kulcs.</li><li>Hiba esetén -1, illetve beállítja a globális errno hibaértéket. </li></ul><p><em>Az ftok függvénnyel tudunk új kulcsot generálni, ám a kulcsgeneráláskor különböző hibák merülhetnek fel. Az ftok függvény beállítja a globális errno hibaértéket, ami a szokásos értékeken kívül például a következő értékekkel bővül ki:</em></p><table class="lecke">
<tr><th><p><strong>Konstans</strong></p></th><th><p>Leírás</p></th></tr><tr><td><p><strong>EACCES</strong></p></td><td><p>Nincs jogosultságunk a művelet végrehajtásához.</p></td></tr><tr><td><p><strong>EBADF</strong></p></td><td><p>Hibás fájlleíró.</p></td></tr><tr><td><p><strong>EFAULT</strong></p></td><td><p>Hibás cím.</p></td></tr><tr><td><p><strong>ENOMEM</strong></p></td><td><p>Nincs elég memória.</p></td></tr><tr><td><p><strong>ELOOP</strong></p></td><td><p>Túl sok szimbolikus link az elérési útvonalban.</p></td></tr><tr><td><p><strong>ENAMETOOLONG</strong></p></td><td><p>A megadott útvonal (pathname) túl hosszú.</p></td></tr><tr><td><p><strong>ENOENT</strong></p></td><td><p>A megadott útvonal (pathname) egyik <span class="fogalom" title="könyvtár">könyvtára</span> nem létezik.</p></td></tr><tr><td><p><strong>ENOTDIR</strong></p></td><td><p>A megadott útvonal (pathname) egyik <span class="fogalom" title="könyvtár">könyvtára</span> nem <span class="fogalom" title="könyvtár">könyvtár</span>.</p></td></tr></table><p>További hibaértékek a referencia-kézikönyvben (manual) találhatók.</p><h3><a name="hiv5" id="hiv5" ></a>A megosztott memória létrehozása, az shmget függvény:</h3><p>A megosztott memóriát létrehozni az <strong>shmget</strong> függvénnyel tudjuk, amelyhez az <strong><em>ftok</em></strong> függvénnyel létrehozott kulcsot használhatjuk. Ugyanezzel a kulccsal már korábban létrehozott megosztott memóriának az azonosítóját is az shmget függvénnyel tudjuk megszerezni.</p><div class="forraskod"><div class="bekezdes1cm">

#include &lt;sys/ipc.h&gt; 
#include &lt;sys/shm.h&gt; 

int shmget(key_t key, size_t size, int shmflg);
</div>
</div><p>Az shmget függvény paraméterei:</p><ul><li><strong>key</strong>: az <em>ftok</em> függvénnyel létrehozott kulcs.</li><li><strong>size</strong>: a megosztott memória területének mérete bájtban.</li><li><strong>shmflg</strong> kapcsolók (állománykezelésnél használt jogok is itt adhatók meg):<ul><li><strong>IPC_CREAT:</strong> új megosztott memória létrehozása, ha ezt nem adjuk meg, akkor a létező megosztott memóriának az azonosítóját adja meg.</li><li><strong>IPC_EXCL: </strong>ezen kapcsoló esetén hiba történik, ha már létezik megosztott memória a megadott kulccsal.</li></ul></li></ul><p>Az shmget függvény visszatérési értéke: </p><ul><li>Sikeres végrehajtás esetén a megosztott memória azonosítója.</li><li>Hiba esetén -1, illetve beállítja a globális errno hibaértéket. </li></ul><p><em>Az shmget függvénnyel tudjuk a megosztott memóriát létrehozni, ám a megosztott memória létrehozásakor különböző hibák merülhetnek fel. Az shmget függvény beállítja a globális errno hibaértéket, ami a szokásos értékeken kívül például a következő értékekkel bővül ki:</em></p><table class="lecke">
<tr><th><p><strong>Konstans</strong></p></th><th><p>Leírás</p></th></tr><tr><td><p><strong>EACCES</strong></p></td><td><p>Nincs jogosultságunk a művelet végrehajtásához.</p></td></tr><tr><td><p><strong>ENOENT</strong></p></td><td><p>Nincs ilyen kulccsal megosztott memória, és nem volt az IPC_CREAT kapcsoló bekapcsolva.</p></td></tr><tr><td><p><strong>EINVAL</strong></p></td><td><p>Hibás méret, vagy a létező megosztott memóriaterület kisebb, mint a megadott méret.</p></td></tr><tr><td><p><strong>EIDRM</strong></p></td><td><p>A megosztott memória már törlésre van jelölve.</p></td></tr><tr><td><p><strong>EEXIST</strong></p></td><td><p>Az IPC_CREAT | IPC_EXCL kapcsolók esetén a megadott kulccsal már létezett megosztott memória.</p></td></tr><tr><td><p><strong>ENOSPC</strong></p></td><td><p>Nem lehet több megosztott memóriát létrehozni a rendszeren.</p></td></tr><tr><td><p><strong>ENOMEM</strong></p></td><td><p>Nincs elég memória.</p></td></tr></table><p>További hibaértékek a referencia-kézikönyvben (manual) találhatók.</p><h3><a name="hiv6" id="hiv6" ></a>A megosztott memóriaterület elérése, az shmat függvény</h3><p>A megosztott memóriaterületet is a &#132;normál&#148; memóriához hasonlóan mutató (memóriacím) segítségével tudjuk elérni. A megosztott memóriához csatlakozni és címet kérni az <strong>shmat</strong> függvénnyel tudunk.</p><div class="forraskod"><div class="bekezdes1cm">

#include &lt;sys/ipc.h&gt; 
#include &lt;sys/shm.h&gt; 

int shmat(int shmid, const void * shmaddr, int shmflg);
</div>
</div><p>Az shmat függvény paraméterei:</p><ul><li><strong>shmid</strong>: az <em>shmget </em>függvény által megadott azonosító.</li><li><strong>shmaddr</strong>: a memóriacím, amelyen keresztül szeretnénk elérni a megosztott memóriát.<ul><li>Ha NULL, akkor az <span class="fogalom" title="operációs rendszer">operációs rendszer</span> ad egy címet.</li><li>Ha nem NULL, és a harmadik paraméterben szerepel az SHM_RND kapcsoló, akkor az <span class="fogalom" title="operációs rendszer">operációs rendszer</span> az adott címet, ha szükséges, kerekíti, és ezen keresztül érhető el a megosztott memória.</li><li>Ha nem NULL, és a harmadik paraméterben nem szerepel az SHM_RND kapcsoló, akkor a címnek az SHMLBA többszörösével kell megegyeznie.</li></ul></li><li><strong>shmflg</strong> kapcsolók:<ul><li><strong>SHM_RND: </strong>a második paraméterben adott címet szükség esetén kerekíti.</li><li><strong>SHM_RDONLY: </strong>csak olvasható lesz a hozzáférés.</li></ul></li></ul><p>Az shmat függvény visszatérési értéke: </p><ul><li>Sikeres végrehajtás esetén a megosztott memória címe.</li><li>Hiba esetén -1, illetve beállítja a globális errno hibaértéket. </li></ul><p><em>Az shmat függvénnyel tudjuk a megosztott memóriaterületet elérni, ám a megosztott memóriaterületet elérésekor különböző hibák merülhetnek fel. Az shmat függvény beállítja a globális errno hibaértéket, ami a szokásos értékeken kívül például a következő értékekkel bővül ki:</em></p><table class="lecke">
<tr><td><p><strong>Konstans</strong></p></td><td><p>Leírás</p></td></tr><tr><td><p><strong>EACCES</strong></p></td><td><p>Nincs jogosultságunk a művelet végrehajtásához.</p></td></tr><tr><td><p><strong>ENOMEM</strong></p></td><td><p>Nincs elég memória.</p></td></tr><tr><td><p><strong>EINVAL</strong></p></td><td><p>Hibás az &#132;shmid&#148;, vagy az &#132;shmaddr&#148; paraméter.</p></td></tr></table><p>További hibaértékek a referencia-kézikönyvben (manual) találhatók.</p><h3><a name="hiv7" id="hiv7" ></a>A megosztott memóriaterület leválasztása, az shmdt függvény</h3><p>Egy megosztott memóriaterületről leválni az <strong>shmdt</strong> függvénnyel lehet. A rendszerből csak akkor lehet törölni a megosztott memóriát, ha nincs rácsatlakozva folyamat. A folyamat kilépésekor a leválás mindenképpen megtörténik.</p><div class="forraskod"><div class="bekezdes1cm">

#include &lt;sys/ipc.h&gt; 
#include &lt;sys/shm.h&gt; 

int shmdt(const void * shmaddr);
</div>
</div><p>Az shmdt függvény paraméterei:</p><ul><li>shmaddr: a memóriacím, amelyet az <em>shmat</em> függvény adott meg.</li></ul><p>Az shmdt függvény visszatérési értéke: </p><ul><li>Sikeres végrehajtás esetén nulla.</li><li>Hiba esetén -1, illetve beállítja a globális errno hibaértéket. </li></ul><p><em>Az shmdt függvénnyel tudunk egy megosztott memóriaterületről leválni, ám a megosztott memóriaterületről való leváláskor különböző hibák merülhetnek fel. Az shmdt függvény beállítja a globális errno hibaértéket, ami a szokásos értékeken kívül például a következő értékekkel bővül ki:</em></p><table class="lecke">
<tr><th><p><strong>Konstans</strong></p></th><th><p>Leírás</p></th></tr><tr><td><p><strong>EINVAL</strong></p></td><td><p>Hibás az &#132;shmaddr&#148; paraméter, azaz nincsen erre a memóriacímre leképezve megosztott memória.</p></td></tr></table><p>További hibaértékek a referencia-kézikönyvben (manual) találhatók.</p><h3><a name="hiv8" id="hiv8" ></a>A megosztott memóriaterület kezelése, az shctl függvény</h3><p>Az <strong>shmctl</strong> függvény segítségével többféle műveletet végezhetünk a megosztott memóriaterülettel. Lekérdezhetjük, beállíthatjuk a tulajdonságait, törölhetjük a megosztott memóriát. </p><div class="forraskod"><div class="bekezdes1cm">

#include &lt;sys/ipc.h&gt; 
#include &lt;sys/shm.h&gt; 

int shmctl(int shmid, int cmd, struct shmid_ds * buf);
</div>
</div><p>Az shmctl függvény paraméterei:</p><ul><li><strong>shmid</strong>: a megosztott memória azonosítója (az <em>shmget</em> függvény adta meg).</li><li><strong>cmd</strong>: parancs.<ul><li><strong>IPC_STAT: </strong>a megosztott memória adatainak a lekérdezése a harmadik paraméterben megadott címre;</li><li><strong>IPC_SET: </strong>a megosztott memória adatainak a módosítása a harmadik paraméterben megadott tulajdonságokkal;</li><li><strong>IPC_RMID: </strong>törlésre jelöli a megosztott memóriát. Az utolsó csatlakozás leválása után fog csak törlődni.</li></ul></li><li><strong>buf</strong>: a megosztott memória tulajdonságait hordozó shmid_ds típusú struktúrára mutató memóriacím, amelynek szerepe a második paramétertől függ.</li></ul><p>Az shmctl függvény visszatérési értéke: </p><ul><li>Sikeres végrehajtás esetén nulla.</li><li>Hiba esetén -1, illetve beállítja a globális errno hibaértéket. </li></ul><p><em>Az shmctl függvénnyel tudjuk a megosztott memóriaterületet kezelni, ám a megosztott memóriaterület kezeléskor különböző hibák merülhetnek fel. Az shmctl függvény beállítja a globális errno hibaértéket, ami a szokásos értékeken kívül például a következő értékekkel bővül ki:</em></p><table class="lecke">
<tr><th><p><strong>Konstans</strong></p></th><th><p>Leírás</p></th></tr><tr><td><p><strong>EACCES</strong></p></td><td><p>Nincs jogosultságunk a művelet végrehajtásához az IPC_STAT estén, ha nincs olvasási jog.</p></td></tr><tr><td><p><strong>EFAULT</strong></p></td><td><p>A &#132;cmd&#148; az IPC_SET, vagy az IPC_STAT, de a harmadik paraméter nem megfelelő.</p></td></tr><tr><td><p><strong>EINVAL</strong></p></td><td><p>Hibás a &#132;cmd&#148; vagy a &#132;shmid&#148; paraméter.</p></td></tr><tr><td><p><strong>EIDRM</strong></p></td><td><p>A megosztott memória már törölve lett.</p></td></tr><tr><td><p><strong>EPERM</strong></p></td><td><p>Nincs jogunk végrehajtani a kért műveletet.</p></td></tr><tr><td><p><strong>EOVVERFLOW</strong></p></td><td><p>Az IPC_STAT esetén az uid, vagy a gid tárolására nincs elég hely a &#132;buf&#148; struktúrában.</p></td></tr></table><p>További hibaértékek a referencia-kézikönyvben (manual) találhatók.</p><p><em>A <strong>shmid_ds</strong> típusú struktúra a sys/shm.h header fájlban van meghatározva. A shmid_ds típusú struktúra a következőképpen épül fel:</em></p><div class="forraskod"><div class="bekezdes1cm">

struct shmid_ds { 
     struct ipc_perm  shm_perm;   /* Definiálja a tulajdonost, és 
                                     a jogosultságokat. */ 
     int              shm_segsz;  /* A méret (bájtokban). */ 
     time_t           shm_atime;  /* Az utolsó kapcsolódás időpontja. */ 
     time_t           shm_dtime;  /* Az utolsó leválás időpontja. */ 
     time_t           shm_ctime;  /* Az utolsó módosítás időpontja. */ 
     unsigned short   shm_cpid;   /* A létrehozó PID azonosítója. */ 
     unsigned short   shm_lpid;   /* Az utolsó shmat, vagy shmdt művelelet 
                                     PID azonosítója */ 
     short            shm_nattch; /* A csatlakozó kapcsolatok száma. */ 
};
</div>
</div><p><em>Az <strong>ipc_perm</strong> típusú struktúra a sys/ipc.h header fájlban van meghatározva. A ipc_perm típusú struktúra a következőképpen épül fel:</em></p><div class="forraskod"><div class="bekezdes1cm">

struct ipc_perm { 
    key_t key;                  /* A létrehozáskor használt kulcs. */ 
    uid_t uid;                  /* A tulajdonos UID azonosítója. */ 
    gid_t gid;                  /* A tulajdonos GID csoportazonosítója. */ 
    uid_t cuid;                 /* A létrehozó UID azonosítója. */ 
    gid_t cgid;                 /* A létrehozó GID csoportazonosítója. */ 
    unsigned short mode;        /* A jogosultságok megadása. Ugyanolyan, 
                                   mint a fájloknál, csak még plusz 
                                   jogosultságként megjelennek az SHM_DEST 
                                   és az SHM_LOCKED kapcsolók. */ 
    unsigned short seq;         /* A sorozatszám. */ 
};
</div>
</div><p>Az <em>ipcs</em> shell parancs segítségével tudjuk megnézni az IPC-eszközöket (megosztott memória, <span class="fogalom" title="szemafor">szemafor</span>, üzenetsor). Törölni az ipcrm parancs segítségével tudunk.</p><!--fej11_kep_2--><div class="kep kozep" style="max-width:660px;"><img src="kepek/fej11_kep2_w660.jpg" alt="A képen az ipcs parancs eredménye látható" style="width:100%; height:auto;" title="A képen az ipcs parancs eredménye látható" /><span class="kepalairas"></span><div class="kep_ikonok jobbra"><span class="kep_nagymeret"><a href="kepek/fej11_kep2_w660_full.html" title="Kép megtekintése külön ablakban" >A fenti kép <span class="kepnev">()</span> megtekintése külön ablakban</a></span></div></div><div class="uresmargo"></div><!--ENDfej11_kep_2--><p class="vissza"><a href="#fejezetek">Vissza a tartalom<span class="gyorsb">j</span>egyzékhez</a></p> 
  </div>
</div>
<div class="utmutato_also">
  <div class="utm_hivatkozasok_also"><a class="oldalteteje" accesskey="f" href="#teteje"><span class="gyorsb">F</span>el a lap tetejére</a>
  <a class="elozotanlap" id="navialsoelozo" href="teszt/lecke10/teszt.html"><img src="navi/ikon_elozolap.gif" alt="Ugrás a tananyag előző oldalára" title="Ugrás a tananyag előző oldalára" width="36" height="36" /></a>
  <a id='navialsokov' class="kovetktanlap" href="lecke11_lap2.html"><img src="navi/ikon_kovetklap.gif" alt="Ugrás a tananyag következő oldalára" title="Ugrás a tananyag következő oldalára" width="36" height="36"/></a>
  </div>
</div>
<div class="ki_stilus"></div>
<div class="impresszum">
  <table class="uszt">
    <tr>
      <td><div class="imp_eltetatklogo"><img alt="ELTE és ELTE TáTK logó" src="css/arculat/elte_plus_tatk.png" style="width:100%;height:auto;" /></div>
        <div class="imp_elteiklogo"><img alt="ELTE és ELTE IK logó" src="css/arculat/elte_plus_ik.png" style="width:100%;height:auto;" /></div></td>
      <td><div class="imp_uszt"><img alt="Új Széchenyi terv" src="css/arculat/USZT_logo_cmyk.jpg" style="width:100%;height:auto;" /></div></td>
      <td><div class="imp_eu"><img alt="A projekt az Európai Unió támogatásával, az Európai Szociális Alap társfinanszirozásával valósul meg." title="A projekt az Európai Unió támogatásával, az Európai Szociális Alap társfinanszirozásával valósul meg." src="css/arculat/ESZA.png" style="width:100%;height:auto;"/></div></td>
    </tr>
  </table>
</div>
</body>
</html>
