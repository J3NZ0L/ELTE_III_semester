<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="hu" lang="hu">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link href="css/scormelte_alap.css" rel="stylesheet" type="text/css" title="" />
<link href="css/style_spec.css" rel="stylesheet" type="text/css" />
<link href="css/scormelte_nagy.css" rel="alternate stylesheet" type="text/css" title="nagy" />
<link href="css/scormelte_inverz.css" rel="alternate stylesheet" type="text/css" title="inverz" />
<!--[if lte IE 6]>
<link href="css/scormelte_ie6.css" rel="stylesheet" type="text/css" title="" />
<![endif]-->
<!-- syntax highlight -->
<link rel="stylesheet" type="text/css" href="css/shCore.css" />
<link rel="stylesheet" type="text/css" href="css/shThemeDefault.css" />
<script type="text/javascript" src="js/shCore.js"></script>
<script type="text/javascript" src="js/shBrushCpp.js"></script>
<script type="text/javascript" src="js/shBrushCSharp.js"></script>
<script type="text/javascript" src="js/shBrushDelphi.js"></script>
<script type="text/javascript" src="js/shBrushXml.js"></script>
<script type="text/javascript" src="js/shBrushCss.js"></script>
<script type="text/javascript" src="js/shBrushJScript.js"></script>
<script type="text/javascript" src="js/shBrushSql.js"></script>
<script type="text/javascript">
SyntaxHighlighter.all()
</script>
<title>
Számítógépes alapismeretek II. / 
Osztott memória, üzenetküldés, rendszerhívások és alkalmazásaik. A folyamatok közötti kommunikáció
/A folyamatok közötti kommunikáció</title>
<meta name="description" content="A tananyag  fejlesztése a TÁMOP-4.1.2.A/2-10/1 pályázat keretén belül történt." />
<meta name="keywords" content="Hardver alapismeretek, operációs rendszer, számítógépes alapismeretek, operációs rendszer fogalma, operációs rendszerek története, operációs rendszer feladata, operációs rendszer generációk, operációs rendszer típusok, folyamatok, folyamat táblázat, szál &ndash; folyamatok, rendszerhívások, operációs rendszer struktúrák, kernelmód, kernel, felhasználói mód, B/K művelet, folyamatok modellje, szinkron rendszerhívás, asszinkron rendszerhívás, állapotai, megvalósításuk, folyamatok kommunikációja, IPC (Inter Process Communication), megszakítástábla, IDT, megszakításvezérlő, PIC, megszakítás, interrupt, megszakításkérelem, IRQ, megszakításkezelési folyamat, kivétel, hibakeresés (debuggolás), töréspont, fájlrendszer, MBR, partíciós szektor, Ntldr, klaszter (cluster), szektor, FAT, NTFS, ext, TSS, csapda, ütemezés, szál, szemafor, mutex, monitor, POSIX, szignál, osztott memória, csővezeték, kritikus szakasz, Wybe Dijkstra, CPU, erőforrás, holtpont, kiéheztetés, integrált áramkör, multiprogramozás, beágyazott rendszerek, partíció, MMU, lapcsere, FIFO, socket, lapozás, swap, interaktív rendszer, kötegelt rendszer, kliens, job, jogosultság, metaadat, könyvtár, UNIX, GNU/LINUX, erőforrás-foglalási gráf, fizikai memória, virtuális memória, merevlemez, floppy, fregmentáció, defregmentáló program, MFT, API, i-node, cache memory, SSH, HyperThread, párhuzamosság" />
<script type="text/javascript" src="js/jquery-1.3.2.min.js"></script>
<script type="text/javascript" src="js/kep.js"></script>
<script type="text/javascript" src="js/jquery.media.js"></script>
<script type="text/javascript" src="js/jquery.highlight-3.js"></script>
<script type="text/javascript" src="js/kereses.js"></script>
<script type="text/javascript" src="js/stylesheetToggle.js"></script>
<script type="text/javascript" src="js/cookie.js"></script>
<script type="text/javascript" src="js/stilusvalto.js"></script>
<script type="text/javascript" src="js/fogalmak.js"></script>
<script type="text/javascript" src="js/fogalom.js"></script>
<script type="text/javascript" src="js/jwplayer.js"></script>
<script type="text/javascript">
$(document).ready(function() 
{
$("a.hang").media( {width: 250, height: 50,  autoplay: false} );
});
</script>
<script type="text/javascript" src="js/navigacio.js"></script>
</head>
<body>
<div><a name="teteje"  id="teteje"></a></div>
<div class="jawsfmenu">
  <ul>
    <li><a class="tartalom" href="#tartalom" accesskey="t" tabindex="2">Ugrás a <span class="gyorsb">t</span>artalomra</a></li>
    <li><a class="tartalomj" href="#fejezetek" accesskey="j" tabindex="5">Ugrás a tartalom<span class="gyorsb">j</span>egyzékre</a></li>
    <li><a class="tanutm" href="#tanutm" accesskey="u" tabindex="7">Ugrás a tan<span class="gyorsb">u</span>lási útmutatóra</a></li>
  </ul>
</div>
<div class="ki_kereses"></div>
<div class="oldal">
  <div class="utmutato">
    <div class="utm_hivatkozasok"><span class="elozolap"><img src="navi/ikon_vissza_dis.gif" alt="Vissza az előzőleg látogatott oldalra (nem elérhető funkció)" title="Vissza az előzőleg látogatott oldalra (nem elérhető funkció)" /></span><a class="kezdolap" href="index.html" accesskey="p" tabindex="21"><img src="navi/ikon_kezdolap.gif" alt="Vissza a modul kezdőlapjára" title="Vissza a modul kezdőlapjára" width="36" height="36"/></a><a class="elozotanlap" href="lecke11_lap2.html" accesskey="e" tabindex="22"><img src="navi/ikon_elozolap.gif" alt="Ugrás a tananyag előző oldalára" title="Ugrás a tananyag előző oldalára" width="36" height="36" /></a><a class="kovetktanlap" href="lecke11_lap4.html" accesskey="v" tabindex="23"><img src="navi/ikon_kovetklap.gif" alt="Ugrás a tananyag következő oldalára" title="Ugrás a tananyag következő oldalára" width="36" height="36"/></a><span class="ki_fogalomkapcs"><img src="navi/ikon_fogalmakbe_dis.gif" alt="Fogalom megjelenítés (nem elérhető funckió)" title="Fogalom megjelenítés (nem elérhető funckió)" /></span><span class="ki_fogalomlista"><img src="navi/ikon_fogalmaklista_dis.gif" alt="Fogalmak listája (nem elérhető funkció)" title="Fogalmak listája (nem elérhető funkció)" /></span><span class="ki_nyomtatas"><img src="navi/ikon_nyomtatas_dis.gif" alt="Oldal nyomtatása (nem elérhető funkció)" title="Oldal nyomtatása (nem elérhető funkció)" /></span><a class="oldalterkep" href="oldalterkep.html" accesskey="d" tabindex="31"><img src="navi/ikon_oldalterkep.gif" alt="Oldaltérkép megtekintése" title="Oldaltérkép megtekintése"  width="36" height="36" /></a><a class="sugo" href="sugo.html" accesskey="s" tabindex="33"><img src="navi/ikon_sugo.gif" alt="Súgó megtekintése" title="Súgó megtekintése"  width="36" height="36" /></a></div>
  </div>
  <div class="tartalommenu">
    <div class="tartalommenu_fejlec"><span id="lapteteje"><a  href="#teteje"><span class="gyorsb">F</span>el a lap tetejére</a></span><a name="fejezetek"   id="fejezetek">Tartalomjegyzék</a></div>
    <ul><li><a href="#hiv1">Osztott memória, üzenetküldés, rendszerhívások és alkalmazásaik. A folyamatok közötti kommunikáció</a><ul><li><a href="#hiv2">A folyamatok közötti kommunikáció</a><ul><li><a href="#hiv3">Üzenetsor</a><ul><li><a href="#hiv4">Az üzenetsor létrehozása, a msgget függvény</a></li><li><a href="#hiv5">Az üzenet küldése, a msgsnd függvény</a></li><li><a href="#hiv6">Az üzenet fogadása, az msgrcv függvény</a></li><li><a href="#hiv7">Az üzenetsor kezelése, az msgctl függvény</a></li></ul></li></ul></li></ul></li></ul> 
  </div>
  <div class="tartalom"> <a name="tartalom"    id="tartalom"></a> 
    <h1><a name="hiv1" id="hiv1"></a>Osztott memória, üzenetküldés, rendszerhívások és alkalmazásaik. A folyamatok közötti kommunikáció</h1><h2><a name="hiv2" id="hiv2"></a>A folyamatok közötti kommunikáció</h2><h3><a name="hiv3" id="hiv3"></a>Üzenetsor</h3><p>A folyamatok közötti kommunikáció megvalósítására használható eszköz az üzenetsor. A &#132;termelő-fogyasztó problémánál&#148; bemutatott kommunikációs sémát használja. Ha az üzenetsor megtelik, a termelő várakozik, ha pedig kiürül az üzenetsor, akkor a fogyasztó várakozik. Az üzenetsorbeli üzeneteknek típust is adunk, amely lehetőséget teremt a típus szerinti feldolgozásra. </p><h4><a name="hiv4" id="hiv4"></a>Az üzenetsor létrehozása, a msgget függvény</h4><p>Az üzenetsor használatának első lépéseként létre kell hozni az üzenetsort. Ezt az <strong>msgget</strong> függvénnyel tudjuk megtenni. A függvény által visszaadott azonosító segítségével lehet kommunikálni, adminisztrálni és törölni az üzenetsort. </p><div class="forraskod"><div class="bekezdes1cm">

#include &lt;sys/types.h&gt; 
#include &lt;sys/ipc.h&gt; 
#include &lt;sys/msg.h&gt; 

int msgget(key_t key, int msgflg);
</div>
</div><p>A msgget függvény paraméterei: </p><ul><li><strong>key:</strong> az <em>ftok</em> függvénnyel létrehozott kulcs.</li><li><strong>msgflg:</strong> kapcsolók (állománykezelésnél használt jogok is itt adhatók meg): <ul><li><strong>IPC_CREAT: </strong>új üzenetsor létrehozása, ha ezt nem adjuk meg, akkor létező üzenetsornak az azonosítóját adja meg;</li><li><strong>IPC_EXCL: </strong>kapcsoló esetén hiba történik, ha már létezik üzenetsor a megadott kulccsal.</li></ul></li></ul><p>A msgget függvény visszatérési értéke: </p><ul><li>Sikeres végrehajtás esetén az üzenetsor azonosítója.</li><li>Hiba esetén -1, illetve beállítja a globális errno hibaértéket. </li></ul><p><em>A msgget függvénnyel tudjuk az üzenetsort létrehozni, ám az üzenetsor létrehozásakor különböző hibák merülhetnek fel. A msgget függvény beállítja a globális errno hibaértéket, ami a szokásos értékeken kívül például a következő értékekkel bővül ki:</em></p><table class="lecke">
<tr><th><p><strong>Konstans</strong></p></th><th><p>Leírás</p></th></tr><tr><td><p><strong>EACCES</strong></p></td><td><p>Nincs jogosultságunk a művelet végrehajtásához. </p></td></tr><tr><td><p><strong>ENOENT</strong></p></td><td><p>Nem létezik ilyen kulccsal üzenetsor, és nem volt az IPC_CREAT kapcsoló bekapcsolva. </p></td></tr><tr><td><p><strong>ENOMEM</strong></p></td><td><p>Nincs elég memória. </p></td></tr><tr><td><p><strong>EEXIST</strong></p></td><td><p>Az IPC_CREAT | IPC_EXCL kapcsolók esetén a megadott kulccsal már létezett üzenetsor. </p></td></tr><tr><td><p><strong>ENOSPC</strong></p></td><td><p>Nem lehet több üzenetsort létrehozni a rendszeren. </p></td></tr></table><p>További hibaértékek a referencia-kézikönyvben (manual) találhatók.</p><h4><a name="hiv5" id="hiv5"></a>Az üzenet küldése, a msgsnd függvény</h4><p>Üzenetet küldeni az &#132;<em>msgsnd&#148;</em> függvénnyel tudunk. Ha az üzenetsor tele van, akkor alapesetben várakozik a folyamat, amíg nem tudja elhelyezni az üzenetet a sorban. Az üzenet típusa nincs definiálva a fejállományokban, ezért ezt nekünk kell megtenni.</p><div class="forraskod"><div class="bekezdes1cm">

#include &lt;sys/types.h&gt; 
#include &lt;sys/ipc.h&gt; 
#include &lt;sys/msg.h&gt; 

int msgsnd(int msqid, const void *msgp, size_t msgsz, int msgflg);
</div>
</div><p>A msgsnd függvény paraméterei:</p><ul><li><strong>msgid</strong>: az üzenetsor azonosítója (a <em>msgget</em> függvény adja meg).</li><li><strong>msgp</strong>: az üzenetstruktúrára mutató pointer.</li><li><strong>msgsz</strong>: az üzenet tartalmának mérete.</li><li><strong>msgflg</strong> kapcsolók:<ul><li><strong>IPC_NOWAIT: </strong>ha tele van a sor, akkor sem fog blokkolódni, hanem hibával tér vissza.</li></ul></li></ul><p>A msgsnd függvény visszatérési értéke: </p><ul><li>Sikeres végrehajtás esetén nulla.</li><li>Hiba esetén -1, illetve beállítja a globális errno hibaértéket. </li></ul><p><em>A msgsnd függvénnyel tudjuk az üzenetet elküldeni, ám az üzenet elküldésekor különböző hibák merülhetnek fel. A msgsnd függvény beállítja a globális errno hibaértéket, ami a szokásos értékeken kívül például a következő értékekkel bővül ki:</em></p><table class="lecke">
<tr><th><p><strong>Konstans</strong></p></th><th><p>Leírás</p></th></tr><tr><td><p><strong>EACCES</strong></p></td><td><p>Nincs jogosultságunk a művelet végrehajtásához. </p></td></tr><tr><td><p><strong>EAGAIN</strong></p></td><td><p>Nem sikerült elküldeni az üzenetet, mert tele volt az üzenetsor, és az IPC_NOWAIT kapcsoló be volt állítva. </p></td></tr><tr><td><p><strong>ENOMEM</strong></p></td><td><p>Nincs elég memória. </p></td></tr><tr><td><p><strong>EFAULT</strong></p></td><td><p>Az &#132;msgp&#148; paraméter (azaz a küldendő üzenetstruktúra) nem elérhető. </p></td></tr><tr><td><p><strong>EIDRM</strong></p></td><td><p>Az üzenetsor törlés alatt van. </p></td></tr><tr><td><p><strong>EINVAL</strong></p></td><td><p>Hibás azonosító, vagy az üzenet struktúrájának &#132;mtype&#148; értéke hibás, vagy az &#132;msgsz&#148; érték hibás.</p></td></tr><tr><td><p><strong>EINTR</strong></p></td><td><p>A msgsnd függvényt jelzés szakította meg.</p></td></tr></table><p>További hibaértékek a referencia-kézikönyvben (manual) találhatók.</p><p><em>A felhasználó által definiált, küldendő üzenet struktúrája a következőképpen épül fel:</em></p><div class="forraskod"><div class="bekezdes1cm">

struct msgbuf { 
       long mtype;                     /* Az üzenet típusa (szigorúan 
                                          nagyobbnak kell lennie, mint 
                                          nulla. */ 
       char mtext[ÜZENET_HOSSZA];      /* Az üzenet tartalma. */ 
};
</div>
</div><h4><a name="hiv6" id="hiv6"></a>Az üzenet fogadása, az msgrcv függvény</h4><p>Üzenetet fogadni az <strong>msgrcv</strong> függvénnyel tudunk. A folyamat alapesetben blokkolódik, ha nincs üzenet. </p><div class="forraskod"><div class="bekezdes1cm">

#include &lt;sys/types.h&gt; 
#include &lt;sys/ipc.h&gt; 
#include &lt;sys/msg.h&gt; 

ssize_t msgrcv(int msqid, void * msgp, size_t msgsz, long msgtyp, int msgflg);
</div>
</div><p>A msgrcv függvény paraméterei: </p><ul><li>msgid: az üzenetsor azonosítója (a msgget függvény adja meg). </li><li><strong>msgp</strong>: az üzenetstruktúrára mutató pointer. </li><li><strong>msgsz</strong>: az üzenet tartalmának mérete. </li><li><strong>msgtyp</strong>: <ul><li>h a msgtyp = 0, akkor az első üzenetet olvassa;</li><li>ha a msgtyp &gt; 0, akkor az első msgtyp típusú üzenetet olvassa;</li><li>ha a msgtyp &lt; 0, akkor a legkisebb típusú első üzenetet olvassa, ami a msgtyp abszolút értékénél kisebb, vagy egyenlő.</li></ul></li><li><strong>msgflg</strong> kapcsolók: </li><li><strong>IPC_NOWAIT: </strong>ha nincs üzenet, akkor sem fog blokkolódni, hanem hibával tér vissza. </li><li>A msgrcv függvény visszatérési értéke: </li><li>Sikeres végrehajtás esetén a kapott üzenet mérete.</li><li>Hiba esetén -1, illetve beállítja a globális errno hibaértéket. </li></ul><p><em>Az msgsnd függvénnyel tudjuk az üzenetet elküldeni, ám az üzenet elküldésekor különböző hibák merülhetnek fel. Az msgsnd függvény beállítja a globális errno hibaértéket, ami a szokásos értékeken kívül például a következő értékekkel bővül ki:</em></p><table class="lecke">
<tr><th><p><strong>Kontsans</strong></p></th><th><p>Leírás</p></th></tr><tr><td><p><strong>EACCES</strong></p></td><td><p>Nincs jogosultságunk a művelet végrehajtásához. </p></td></tr><tr><td><p><strong>EAGAIN</strong></p></td><td><p>Nem sikerült elküldeni az üzenetet, mert tele volt az üzenetsor, és az IPC_NOWAIT kapcsoló be volt állítva. </p></td></tr><tr><td><p><strong>E2BIG</strong></p></td><td><p>Az üzenet nagyobb, mint az &#132;msgsz&#148; értéke. </p></td></tr><tr><td><p><strong>EFAULT</strong></p></td><td><p>Az &#132;msgp&#148; paraméter (azaz a küldendő üzenetstruktúra) nem elérhető. </p></td></tr><tr><td><p><strong>EIDRM</strong></p></td><td><p>Az üzenetsor törlés alatt van. </p></td></tr><tr><td><p><strong>EINVAL</strong></p></td><td><p>Hibás azonosító, vagy az &#132;msgsz&#148; érték hibás. </p></td></tr><tr><td><p><strong>EINTR</strong></p></td><td><p>Az msgsnd függvényt jelzés szakította meg. </p></td></tr></table><p>További hibaértékek a referencia-kézikönyvben (manual) találhatók.</p><h4><a name="hiv7" id="hiv7"></a>Az üzenetsor kezelése, az msgctl függvény</h4><p>Az &#132;<em>msgctl&#148;</em> függvény segítségével többféle műveletet végezhetünk az üzenetsorral. Lekérdezhetjük, beállíthatjuk a tulajdonságait, törölhetjük. </p><div class="forraskod"><div class="bekezdes1cm">

#include &lt;sys/types.h&gt; 
#include &lt;sys/ipc.h&gt; 
#include &lt;sys/msg.h&gt; 

int msgctl(int msgid, int cmd, struct msgid_ds * buf);
</div>
</div><p>Az msgctl függvény paraméterei:</p><ul><li><strong>msgid</strong>: az üzenetsor azonosítója (a <em>msgget</em> függvény adja meg). </li><li><strong>cmd</strong>: parancs. <ul><li><strong>PC_STAT:  </strong>az üzenetsor adatainak a lekérdezése a harmadik paraméterben megadott címre. </li><li><strong>IPC_SET: </strong>az üzenetsor adatainak a módosítása a harmadik paraméterben megadott tulajdonságokkal. </li><li><strong>IPC_RMID: </strong>törli az üzenetsort. </li></ul></li><li><strong>buf:</strong> az üzenetsor tulajdonságait hordozó struktúrára mutató, amelynek szerepe a második paramétertől függ.</li></ul><p>A msgctl függvény visszatérési értéke: </p><ul><li>Sikeres végrehajtás esetén nulla.</li><li>Hiba esetén -1, illetve beállítja a globális errno hibaértéket. </li></ul><p><em>A msgctl függvénnyel tudjuk az üzenetsort kezelni, ám az üzenetsor kezelésekor különböző hibák merülhetnek fel. A msgctl függvény beállítja a globális errno hibaértéket, ami a szokásos értékeken kívül például a következő értékekkel bővül ki:</em></p><table class="lecke">
<tr><th><p><strong>Konstans</strong></p></th><th><p>Leírás</p></th></tr><tr><td><p><strong>EACCES</strong></p></td><td><p>Nincs jogosultságunk a művelet végrehajtásához az IPC_STAT estén, ha nincs olvasási jog. </p></td></tr><tr><td><p><strong>EFAULT</strong></p></td><td><p>Az &#132;cmd&#148; az IPC_SET vagy az IPC_STAT, de a harmadik paraméter nem megfelelő. </p></td></tr><tr><td><p><strong>EINVAL</strong></p></td><td><p>Hibás a &#132;cmd&#148; vagy a &#132;msgid&#148; paraméter. </p></td></tr><tr><td><p><strong>EIDRM</strong></p></td><td><p>Az üzenetsor törölve lett. </p></td></tr><tr><td><p><strong>EPERM</strong></p></td><td><p>Nincs jogunk végrehajtani a kért műveletet. </p></td></tr></table><p>További hibaértékek a referencia-kézikönyvben (manual) találhatók.</p><p class="vissza"><a href="#fejezetek">Vissza a tartalom<span class="gyorsb">j</span>egyzékhez</a></p> 
  </div>
</div>
<div class="utmutato_also">
  <div class="utm_hivatkozasok_also"><a class="oldalteteje" accesskey="f" href="#teteje"><span class="gyorsb">F</span>el a lap tetejére</a>
  <a class="elozotanlap" id="navialsoelozo" href="lecke11_lap2.html"><img src="navi/ikon_elozolap.gif" alt="Ugrás a tananyag előző oldalára" title="Ugrás a tananyag előző oldalára" width="36" height="36" /></a>
  <a id='navialsokov' class="kovetktanlap" href="lecke11_lap4.html" ><img src="navi/ikon_kovetklap.gif" alt="Ugrás a tananyag következő oldalára" title="Ugrás a tananyag következő oldalára" width="36" height="36"/></a>
  </div>
</div>
<div class="ki_stilus"></div>
<div class="impresszum">
  <table class="uszt">
    <tr>
      <td><div class="imp_eltetatklogo"><img alt="ELTE és ELTE TáTK logó" src="css/arculat/elte_plus_tatk.png" style="width:100%;height:auto;" /></div>
        <div class="imp_elteiklogo"><img alt="ELTE és ELTE IK logó" src="css/arculat/elte_plus_ik.png" style="width:100%;height:auto;" /></div></td>
      <td><div class="imp_uszt"><img alt="Új Széchenyi terv" src="css/arculat/USZT_logo_cmyk.jpg" style="width:100%;height:auto;" /></div></td>
      <td><div class="imp_eu"><img alt="A projekt az Európai Unió támogatásával, az Európai Szociális Alap társfinanszirozásával valósul meg." title="A projekt az Európai Unió támogatásával, az Európai Szociális Alap társfinanszirozásával valósul meg." src="css/arculat/ESZA.png" style="width:100%;height:auto;"/></div></td>
    </tr>
  </table>
</div>
</body>
</html>