<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="hu" lang="hu">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link href="css/scormelte_alap.css" rel="stylesheet" type="text/css" title="" />
<link href="css/style_spec.css" rel="stylesheet" type="text/css" />
<link href="css/scormelte_nagy.css" rel="alternate stylesheet" type="text/css" title="nagy" />
<link href="css/scormelte_inverz.css" rel="alternate stylesheet" type="text/css" title="inverz" />
<!--[if lte IE 6]>
<link href="css/scormelte_ie6.css" rel="stylesheet" type="text/css" title="" />
<![endif]-->
<!-- syntax highlight -->
<link rel="stylesheet" type="text/css" href="css/shCore.css" />
<link rel="stylesheet" type="text/css" href="css/shThemeDefault.css" />
<script type="text/javascript" src="js/shCore.js"></script>
<script type="text/javascript" src="js/shBrushCpp.js"></script>
<script type="text/javascript" src="js/shBrushCSharp.js"></script>
<script type="text/javascript" src="js/shBrushDelphi.js"></script>
<script type="text/javascript" src="js/shBrushXml.js"></script>
<script type="text/javascript" src="js/shBrushCss.js"></script>
<script type="text/javascript" src="js/shBrushJScript.js"></script>
<script type="text/javascript" src="js/shBrushSql.js"></script>
<script type="text/javascript">
SyntaxHighlighter.all()
</script>
<title>
Számítógépes alapismeretek II. / 
A fájlrendszerbeli könyvtárak és jogosultságok} kezelése
/A könyvtárkezelés feladatok tükrében</title>
<meta name="description" content="A tananyag  fejlesztése a TÁMOP-4.1.2.A/2-10/1 pályázat keretén belül történt." />
<meta name="keywords" content="Hardver alapismeretek, operációs rendszer, számítógépes alapismeretek, operációs rendszer fogalma, operációs rendszerek története, operációs rendszer feladata, operációs rendszer generációk, operációs rendszer típusok, folyamatok, folyamat táblázat, szál &ndash; folyamatok, rendszerhívások, operációs rendszer struktúrák, kernelmód, kernel, felhasználói mód, B/K művelet, folyamatok modellje, szinkron rendszerhívás, asszinkron rendszerhívás, állapotai, megvalósításuk, folyamatok kommunikációja, IPC (Inter Process Communication), megszakítástábla, IDT, megszakításvezérlő, PIC, megszakítás, interrupt, megszakításkérelem, IRQ, megszakításkezelési folyamat, kivétel, hibakeresés (debuggolás), töréspont, fájlrendszer, MBR, partíciós szektor, Ntldr, klaszter (cluster), szektor, FAT, NTFS, ext, TSS, csapda, ütemezés, szál, szemafor, mutex, monitor, POSIX, szignál, osztott memória, csővezeték, kritikus szakasz, Wybe Dijkstra, CPU, erőforrás, holtpont, kiéheztetés, integrált áramkör, multiprogramozás, beágyazott rendszerek, partíció, MMU, lapcsere, FIFO, socket, lapozás, swap, interaktív rendszer, kötegelt rendszer, kliens, job, jogosultság, metaadat, könyvtár, UNIX, GNU/LINUX, erőforrás-foglalási gráf, fizikai memória, virtuális memória, merevlemez, floppy, fregmentáció, defregmentáló program, MFT, API, i-node, cache memory, SSH, HyperThread, párhuzamosság" />
<script type="text/javascript" src="js/jquery-1.3.2.min.js"></script>
<script type="text/javascript" src="js/kep.js"></script>
<script type="text/javascript" src="js/jquery.media.js"></script>
<script type="text/javascript" src="js/jquery.highlight-3.js"></script>
<script type="text/javascript" src="js/kereses.js"></script>
<script type="text/javascript" src="js/stylesheetToggle.js"></script>
<script type="text/javascript" src="js/cookie.js"></script>
<script type="text/javascript" src="js/stilusvalto.js"></script>
<script type="text/javascript" src="js/fogalmak.js"></script>
<script type="text/javascript" src="js/fogalom.js"></script>
<script type="text/javascript" src="js/jwplayer.js"></script>
<script type="text/javascript">
$(document).ready(function() 
{
$("a.hang").media( {width: 250, height: 50,  autoplay: false} );
});
</script>
<script type="text/javascript" src="js/navigacio.js"></script>
</head>
<body>
<div><a name="teteje"  id="teteje"></a></div>
<div class="jawsfmenu">
  <ul>
    <li><a class="tartalom" href="#tartalom" accesskey="t" tabindex="2">Ugrás a <span class="gyorsb">t</span>artalomra</a></li>
    <li><a class="tartalomj" href="#fejezetek" accesskey="j" tabindex="5">Ugrás a tartalom<span class="gyorsb">j</span>egyzékre</a></li>
    <li><a class="tanutm" href="#tanutm" accesskey="u" tabindex="7">Ugrás a tan<span class="gyorsb">u</span>lási útmutatóra</a></li>
  </ul>
</div>
<div class="ki_kereses"></div>
<div class="oldal">
  <div class="utmutato">
    <div class="utm_hivatkozasok"><span class="elozolap"><img src="navi/ikon_vissza_dis.gif" alt="Vissza az előzőleg látogatott oldalra (nem elérhető funkció)" title="Vissza az előzőleg látogatott oldalra (nem elérhető funkció)" /></span><a class="kezdolap" href="index.html" accesskey="p" tabindex="21"><img src="navi/ikon_kezdolap.gif" alt="Vissza a modul kezdőlapjára" title="Vissza a modul kezdőlapjára" width="36" height="36"/></a><a class="elozotanlap" href="lecke4_lap6.html" accesskey="e" tabindex="22"><img src="navi/ikon_elozolap.gif" alt="Ugrás a tananyag előző oldalára" title="Ugrás a tananyag előző oldalára" width="36" height="36" /></a><a class="kovetktanlap" href="lecke4_lap8.html" accesskey="v" tabindex="23"><img src="navi/ikon_kovetklap.gif" alt="Ugrás a tananyag következő oldalára" title="Ugrás a tananyag következő oldalára" width="36" height="36"/></a><span class="ki_fogalomkapcs"><img src="navi/ikon_fogalmakbe_dis.gif" alt="Fogalom megjelenítés (nem elérhető funckió)" title="Fogalom megjelenítés (nem elérhető funckió)" /></span><span class="ki_fogalomlista"><img src="navi/ikon_fogalmaklista_dis.gif" alt="Fogalmak listája (nem elérhető funkció)" title="Fogalmak listája (nem elérhető funkció)" /></span><span class="ki_nyomtatas"><img src="navi/ikon_nyomtatas_dis.gif" alt="Oldal nyomtatása (nem elérhető funkció)" title="Oldal nyomtatása (nem elérhető funkció)" /></span><a class="oldalterkep" href="oldalterkep.html" accesskey="d" tabindex="31"><img src="navi/ikon_oldalterkep.gif" alt="Oldaltérkép megtekintése" title="Oldaltérkép megtekintése"  width="36" height="36" /></a><a class="sugo" href="sugo.html" accesskey="s" tabindex="33"><img src="navi/ikon_sugo.gif" alt="Súgó megtekintése" title="Súgó megtekintése"  width="36" height="36" /></a></div>
  </div>
  <div class="tartalommenu">
    <div class="tartalommenu_fejlec"><span id="lapteteje"><a  href="#teteje"><span class="gyorsb">F</span>el a lap tetejére</a></span><a name="fejezetek"   id="fejezetek">Tartalomjegyzék</a></div>
    <ul><li><a href="#hiv1">A fájlrendszerbeli könyvtárak és jogosultságok kezelése</a><ul><li><a href="#hiv2">A könyvtárkezelés feladatok tükrében</a><ul><li><a href="#hiv3">Az aktuális könyvtár tartalmának kiolvasása</a></li><li><a href="#hiv4">Az aktuális könyvtár alkönyvtárai tartalmának kiolvasása &ndash; a stat struktúra és az S_ISDIR függvény</a></li></ul></li></ul></li></ul> 
  </div>
  <div class="tartalom"> <a name="tartalom"    id="tartalom"></a> 
    <h1><a name="hiv1" id="hiv1"></a>A fájlrendszerbeli könyvtárak és jogosultságok kezelése</h1><h2><a name="hiv2" id="hiv2"></a>A könyvtárkezelés feladatok tükrében</h2><h3><a name="hiv3" id="hiv3"></a>Az aktuális könyvtár tartalmának kiolvasása</h3><p>Olvassuk ki az aktuális <span class="fogalom" title="könyvtár">könyvtár</span> tartalmát, és írjuk ki a fájlneveket! </p><p>A megoldáshoz szükséges a <span class="fogalom" title="könyvtár">könyvtár</span> megnyitása. Végig kell olvasni a <span class="fogalom" title="könyvtár">könyvtár</span> bejegyzéseket és kiírni azokat a képernyőre. A fájlneveket a dirent struktúra d_name tagján keresztül érhetjük el.</p><div class="forraskod"><div class="bekezdes1cm">

#include &lt;stdlib.h&gt; 
#include &lt;stdio.h&gt; 
#include &lt;dirent.h&gt; //A readdir függvény miatt. 
#include &lt;sys/types.h&gt; //A readdir függvény miatt. 
int main() { 
DIR * d; 
struct dirent * direntp; 
printf("Az aktualis konyvtar tartalma: \n"); 
d=opendir("."); 
while ((direntp=readdir(d)) != NULL) { 
printf("%s\n", direntp-&gt;d_name); 
}; 
closedir(d); 
return 0; 
};
</div>
</div><p class="vissza"><a href="#fejezetek">Vissza a tartalom<span class="gyorsb">j</span>egyzékhez</a></p><h3><a name="hiv4" id="hiv4"></a>Az aktuális könyvtár alkönyvtárai tartalmának kiolvasása &ndash; a stat struktúra és az S_ISDIR függvény</h3><p>Módosítsuk az előző feladatot úgy, hogy a <span class="fogalom" title="könyvtár">könyvtár</span> alkönyvtárainak tartalmát is listázzuk ki teljes mélységben! Az egyes <span class="fogalom" title="könyvtár">könyvtári</span> szintek más tabulátorpozíción jelenjenek meg!</p><p>A feladat megoldásának alapgondolata az, hogy egy adott <span class="fogalom" title="könyvtár">könyvtárban</span> levő bejegyzésnevek kiírása közben meg kell vizsgálni, hogy az aktuálisan sorra kerülő állomány <span class="fogalom" title="könyvtár">könyvtár</span> -e. Amennyiben <span class="fogalom" title="könyvtár">könyvtár</span>, átlépünk ebbe az alkönyvtárba mint aktuális munkakönyvtárba, és elindítjuk ennek a <span class="fogalom" title="könyvtár">könyvtárnak</span> a feldolgozását. Ha az alkönyvtárat teljesen feldolgoztuk, akkor visszalépünk a szülőkönyvtárba, és folytatjuk annak a feldolgozását. A kérdés az, hogy hogyan tudjuk megállapítani egy bejegyzésről, hogy az <span class="fogalom" title="könyvtár">könyvtár</span> -e, vagy sem. Emlékezzünk vissza a modul előző leckéjére, ahol a stat függvény segítségével olvastuk ki egy fájl hosszúságát. Akkor már látható volt, hogy a stat struktúra nagyon sok fontos információt szolgáltat az egyes <span class="fogalom" title="könyvtár">könyvtári</span> bejegyzésekkel kapcsolatban. Deklaráljunk tehát egy stat struktúrájú változót! </p><p><span class="forraskod">struct stat My_stat;</span></p><p>Ne felejtsük el, hogy ehhez a megfelelő header fájlokat mind-mind igénybe kell venni! A stat típus a <em>sys/stat.h</em> header fájlban van meghatározva. Idézzük fel a struktúra felépítését!</p><p><em>A stat típusú struktúra a következőképpen épül fel</em>: </p><div class="forraskod"><div class="bekezdes1cm">

struct stat { 
     dev_t     st_dev     // Az i-csomóponthoz tartozó eszköz. 
     ino_t     st_ino     // Az i-csomópont.
     mode_t    st_mode    // A mód. 
     nlink_t   st_nlink   // A linkek száma. 
     uid_t     st_uid     // A felhasználói uid azonosító. 
     gid_t     st_gid     // A csoportazonosító.
     dev_t     st_rdev    // A fő- vagy mellékeszköz. 
     off_t     st_size    // A fájlméret. 
     time_t    st_atime   // Az utolsó hozzáfordulás időpontja. 
     time_t    st_mtime   // Az utolsó módosítás ideje. 
     time_t    st_ctime   // Az utolsó i-csomópont módosítási ideje. 
     blksize_t st_blksize // A fájlrendszerben az adott fájlra vonatkozó 
                          // I/O blokkméret. 
     blkcnt_t  st_blocks  // A lefoglalt blokkok száma. 
};
</div>
</div><p><em>A stat típusú struktúra egyik tagja (st_mode) a módot írja le, amelynek típusa mode_t. A mode_t lehetséges értékei a következők:</em></p><table class="lecke">
<tr><th><p><strong>Konstans</strong></p></th><th><p>Leírás</p></th></tr><tr><td><p><strong>S_IFMT </strong></p></td><td><p>az állomány típusa</p></td></tr><tr><td><p><strong>S_IFBLK</strong></p></td><td><p>speciális blokk </p></td></tr><tr><td><p><strong>S_IFCHR</strong></p></td><td><p>speciális karakter</p></td></tr><tr><td><p><strong>S_IFIFO</strong></p></td><td><p>csővezeték</p></td></tr><tr><td><p><strong>S_IFREG</strong></p></td><td><p>reguláris fájl</p></td></tr><tr><td><p><strong>S_IFDIR</strong></p></td><td><p><span class="fogalom" title="könyvtár">könyvtár</span></p></td></tr><tr><td><p><strong>S_IFLNK</strong></p></td><td><p>szimbolikus link</p></td></tr></table><p><em>Az S_ISDIR függvény</em></p><p>Létezik egy olyan függvény, amely megállapítja, hogy <span class="fogalom" title="könyvtár">könyvtárról</span> van-e szó. Ez az S_ISDIR függvény:</p><div class="forraskod"><div class="bekezdes1cm">

int S_ISDIR(mode_t mod);
if (S_ISDIR(My_stat.st_mode)) { 
     // rekurzív hívást kell alkalmaznunk erre a könyvtárra
};
</div>
</div><p>Készítsük el a függvény vázlatát! Figyeljünk arra, hogy a könyvtárbejegyzések közül az aktuális és a szülőkönyvtárra vonatkozók esetén nem célszerű a rekurzív hívást alkalmazni! Ezt a vázlatot ellenőrzésekkel, illetve lokális változók deklarációjával bővíthetjük.</p><div class="forraskod"><div class="bekezdes1cm">

void Konyvt(char di[]) { 
     chdir(di); 
     d = opendir("."); 
     while ((direntp=readdir(d)) != NULL) { 
          if (((strcmp(direntp-&gt;d_name, ".") != 0) 
               &#38;&#38; ((strcmp(direntp-&gt;d_name, "..") != 0)))) { 
               printf("%s\n", direntp-&gt;d_name); 
               stat(direntp-&gt;d_name, &#38;My_status); 
               if (S_ISDIR(My_status.st_mode)) { 
                    Konyvt(direntp-&gt;d_name); 
               }; 
          }; 
     }; 
     closedir(d); 
     chdir(".."); 
};
</div>
</div><p>A feladat szövege szerint az állományok kiírásának tabuláltan kellene megtörténnie. Nyilvánvalóan ehhez szükség volna annak a feljegyzésére, hogy hányadik szinten vagyunk, és így hány tabulátorpozíciót kell pozicionálni. Legegyszerűbben talán egy szöveges paraméter segítségével dolgozhatunk, amelyben az aktuális formátumsztringet adhatjuk át. A formátumsztring tehát a tabulátorokat tartalmazza, éppen annyit, ahányadik szinten járunk. Módosítsuk a függvényünket egy formátumparaméterrel! Természetesen gondoskodni kell a rekurzív hívásnál is a paraméterek aktuális értékéről. Az aktuális szinthez tartozó formátumsztringhez, mivel új szintre lépünk, hozzá kell fűznünk egy &#132;%t&#148; sztringet. A modul korábbi leckéjében már foglalkoztunk a szövegkezelő függvényekkel, így nem okozhat problémát a következő kódrészlet:</p><div class="forraskod"><div class="bekezdes1cm">

void Konyvt(char form[],char di[]) { 
// ... 
char New_form[80]; 
strcpy(New_form,form); 
strcat(New_form,"\t"); 
// ... 
     Konyvt(New_form, direntp-&gt;d_name); 
// ... 
}; 
</div>
</div><p>A teljes kód ezek után így néz ki:</p><div class="forraskod"><div class="bekezdes1cm">

#include &lt;stdlib.h&gt; 
#include &lt;stdio.h&gt; 
#include &lt;errno.h&gt; // A hibakezeléshez kell. 
#include &lt;dirent.h&gt; // A readdir függvényhez kell. 
#include &lt;sys/types.h&gt; // A readdir függvényhez kell. 
#include &lt;string.h&gt; 
#include &lt;sys/stat.h&gt; // A stat típusú struktúrához kell. 

void Konyvt(char form[],char di[]) { 
     DIR * d; 
     struct dirent * direntp; 
     struct stat My_status; 
     char New_form[80]; 
     strcpy(New_form,form); 
     strcat(New_form,"\t");  // A következő szinthez kell. 
     chdir(di); 
     d = opendir("."); 
     while ((direntp=readdir(d))!=NULL) { 
          if (((strcmp(direntp-&gt;d_name, ".") != 0) &#38;&#38; 
                ((strcmp(direntp-&gt;d_name, "..") != 0)))) { 
               printf(form); 
               printf("%s\n", direntp-&gt;d_name); 
               stat(direntp-&gt;d_name, &#38;My_status); 
               if (S_ISDIR(My_status.st_mode)) { 
                    Konyvt(New_form, direntp-&gt;d_name); 
               }; 
          }; 
     };
     closedir(d);
     chdir(".."); 
};

int main() { 
     char d[80] = "."; 
     printf("Az aktualis konyvtar tartalma: \n"); 
     Konyvt(" ", d); 
     return 0; 
};
</div>
</div><p class="vissza"><a href="#fejezetek">Vissza a tartalom<span class="gyorsb">j</span>egyzékhez</a></p> 
  </div>
</div>
<div class="utmutato_also">
  <div class="utm_hivatkozasok_also"><a class="oldalteteje" accesskey="f" href="#teteje"><span class="gyorsb">F</span>el a lap tetejére</a>
  <a class="elozotanlap" id="navialsoelozo" href="lecke4_lap6.html"><img src="navi/ikon_elozolap.gif" alt="Ugrás a tananyag előző oldalára" title="Ugrás a tananyag előző oldalára" width="36" height="36" /></a>
  <a id='navialsokov' class="kovetktanlap" href="lecke4_lap8.html" ><img src="navi/ikon_kovetklap.gif" alt="Ugrás a tananyag következő oldalára" title="Ugrás a tananyag következő oldalára" width="36" height="36"/></a>
  </div>
</div>
<div class="ki_stilus"></div>
<div class="impresszum">
  <table class="uszt">
    <tr>
      <td><div class="imp_eltetatklogo"><img alt="ELTE és ELTE TáTK logó" src="css/arculat/elte_plus_tatk.png" style="width:100%;height:auto;" /></div>
        <div class="imp_elteiklogo"><img alt="ELTE és ELTE IK logó" src="css/arculat/elte_plus_ik.png" style="width:100%;height:auto;" /></div></td>
      <td><div class="imp_uszt"><img alt="Új Széchenyi terv" src="css/arculat/USZT_logo_cmyk.jpg" style="width:100%;height:auto;" /></div></td>
      <td><div class="imp_eu"><img alt="A projekt az Európai Unió támogatásával, az Európai Szociális Alap társfinanszirozásával valósul meg." title="A projekt az Európai Unió támogatásával, az Európai Szociális Alap társfinanszirozásával valósul meg." src="css/arculat/ESZA.png" style="width:100%;height:auto;"/></div></td>
    </tr>
  </table>
</div>
</body>
</html>